import{u as q,j as e,R as X,I as y,L as I,a as z,b as H,P as J}from"./index-BZ7LQtDa.js";import{r as w,d as A,A as Y,C as E,X as F,Y as K,T as V,i as Z,B as ee,e as te,h as se,j as ae,L as re,k as Q}from"./vendor-charts-aQyCzDkf.js";import{D as le}from"./database-DiR55LNY.js";import{E as oe}from"./external-link-BgzbLVYK.js";import"./vendor-pdf-og5EeDf1.js";import"./vendor-firebase-BEgIyS5z.js";const ne="https://dam-api.bfs.admin.ch/hub/api/dam/assets/36198674/master",ie="https://www.bfs.admin.ch/asset/it/px-x-0302010000_108",W="bfs_stats_cache",ce=t=>{try{const a=x=>{const n=new RegExp(`VALUES\\(["']?${x}["']?\\)=([^;]+?);`,"s");let s=t.match(n);if(!s){const m=new RegExp(`VALUES\\(${x.replace(/"/g,'\\"')}\\)=([^;]+?);`,"s");s=t.match(m)}return s?s[1].replace(/[\r\n]+/g," ").replace(/\s+/g," ").trim().split(",").map(m=>m.replace(/^["']|["']$/g,"").trim()).filter(Boolean):[]},r=x=>{const n=new RegExp(`${x}=([^;]+?);`,"s"),s=t.match(n);return s?s[1].replace(/[\r\n\t\s]+/g,"").replace(/"/g,"").split(",").map(b=>b.trim()).filter(Boolean):[]},l=r("STUB"),h=r("HEADING"),d=[...l,...h];if(d.length===0)return null;const i={},c={};d.forEach((x,n)=>{i[x]=n,c[x]=a(x)});const o=t.match(/DATA=([^;]+);/s);if(!o)return null;const g=o[1].replace(/[\s\r\n]+/g," ").trim().split(" ").map(x=>{if(x==='"."'||x===".")return 0;const n=parseFloat(x);return isNaN(n)?0:n});return{dimensions:d,values:c,data:g,dimensionMap:i}}catch(a){return console.error("PX Parsing Error",a),null}},u=(t,...a)=>t.dimensions.find(r=>a.some(l=>r.toLowerCase().includes(l.toLowerCase()))),p=(t,a,...r)=>{var d;if(!a||!t.values[a])return((d=t.values[a])==null?void 0:d[0])||"";const l=t.values[a];if(r.some(i=>i==="0"||i.toLowerCase().includes("total"))){const i=["Total","Totale","totale","total","Total "];for(const o of i){const f=l.find(g=>g.includes(o));if(f)return f}const c=l.find(o=>o.startsWith("0 "));if(c)return c}for(const i of r){const c=l.find(o=>o===i||o.startsWith(i+" "));if(c)return c}for(const i of r){const c=l.find(o=>o.toLowerCase().includes(i.toLowerCase()));if(c)return c}return l[0]},L=(t,a)=>{let r=0,l=1;for(let h=t.dimensions.length-1;h>=0;h--){const d=t.dimensions[h],i=t.values[d]||[],c=a[d];let o=0;c&&(o=i.indexOf(c),o===-1&&(o=0)),r+=o*l,l*=i.length}return t.data[r]||0},de=t=>{const a=u(t,"Quartal","Trimestre","Time"),r=u(t,"Kanton","Cantone","Region","Arbeitskanton"),l=u(t,"Geschlecht","Sesso"),h=u(t,"Wirtschaftssektor","Sezione","Settore"),d=u(t,"Altersklasse","Classe","EtÃ ");if(!a)return[];const i=t.values[a],c=[],o=p(t,r||"","21","Ticino"),f=p(t,l||"","Total","0","Totale"),g=p(t,h||"","Total","0","Totale"),x=p(t,d||"","Total","0","Totale"),n={[r||"Kanton"]:o,[l||"Geschlecht"]:f,[h||"Wirtschaftssektor"]:g,[d||"Altersklasse"]:x};for(const s of i){n[a]=s;const b=L(t,n);let m=s;const k=s.match(/(\d{4})[Q](\d)/);k&&(m=`${k[1]} Q${k[2]}`),c.push({year:m,frontalieri:b})}return c.slice(-16)},me=t=>{const a=u(t,"Altersklasse","Classe","EtÃ "),r=u(t,"Quartal","Trimestre"),l=u(t,"Kanton","Cantone","Arbeitskanton"),h=u(t,"Geschlecht","Sesso"),d=u(t,"Wirtschaftssektor","Sezione","Settore");if(!a||!r)return[];const i=t.values[r][t.values[r].length-1],c=p(t,l||"","21","Ticino"),o=p(t,h||"","Total","0"),f=p(t,d||"","Total","0");return t.values[a].filter(n=>!n.toLowerCase().includes("total")&&!n.startsWith("0")).map(n=>{const s={[l||"Kanton"]:c,[h||"Geschlecht"]:o,[d||"Wirtschaftssektor"]:f,[r]:i,[a]:n};return{name:n.replace(" anni","").replace("Jahre",""),value:L(t,s)}}).sort((n,s)=>s.value-n.value)},xe=t=>{const a=u(t,"Geschlecht","Sesso"),r=u(t,"Quartal","Trimestre"),l=u(t,"Kanton","Cantone","Arbeitskanton"),h=u(t,"Wirtschaftssektor","Sezione","Settore"),d=u(t,"Altersklasse","Classe","EtÃ ");if(!a||!r)return[];const i=t.values[r].slice(-16),c=p(t,l||"","21","Ticino"),o=p(t,h||"","Total","0"),f=p(t,d||"","Total","0"),g=t.values[a],x=g.find(s=>s.startsWith("1")||s.toLowerCase().includes("uomi")||s.toLowerCase().includes("mann")),n=g.find(s=>s.startsWith("2")||s.toLowerCase().includes("donne")||s.toLowerCase().includes("frau"));return!x||!n?[]:i.map(s=>{let b=s;const m=s.match(/(\d{4})[Q](\d)/);m&&(b=`${m[1]} Q${m[2]}`);const k={year:b};return k.Uomini=L(t,{[l||"Kanton"]:c,[a]:x,[d||"Altersklasse"]:f,[r]:s,[h||"Wirtschaftssektor"]:o}),k.Donne=L(t,{[l||"Kanton"]:c,[a]:n,[d||"Altersklasse"]:f,[r]:s,[h||"Wirtschaftssektor"]:o}),k})},he=t=>{const a=u(t,"Geschlecht","Sesso"),r=u(t,"Quartal","Trimestre"),l=u(t,"Kanton","Cantone","Arbeitskanton"),h=u(t,"Wirtschaftssektor","Sezione","Settore"),d=u(t,"Altersklasse","Classe");if(!a||!r)return[];const i=t.values[r][t.values[r].length-1],c=p(t,l||"","21","Ticino"),o=p(t,h||"","Total","0"),f=p(t,d||"","Total","0"),x=t.values[a].filter(s=>!s.startsWith("0")&&!s.toLowerCase().includes("total")).map(s=>{const b={[l||"Kanton"]:c,[h||"Wirtschaftssektor"]:o,[d||"Altersklasse"]:f,[r]:i,[a]:s};let m=s;return(m.includes("1")||m.toLowerCase().includes("uomi")||m.toLowerCase().includes("mann"))&&(m="Uomini"),(m.includes("2")||m.toLowerCase().includes("donn")||m.toLowerCase().includes("frau"))&&(m="Donne"),{name:m,value:L(t,b),color:m==="Uomini"?"#3b82f6":"#ec4899"}}).sort((s,b)=>b.value-s.value),n=x.reduce((s,b)=>s+b.value,0);return x.map(s=>({...s,percent:n>0?(s.value/n*100).toFixed(1):"0"}))},ve=()=>{var $;const{t}=q(),[a,r]=w.useState([]),[l,h]=w.useState([]),[d,i]=w.useState([]),[c,o]=w.useState([]),[f,g]=w.useState(!0),[x,n]=w.useState(!1),[s,b]=w.useState(null),[m,k]=w.useState(null),R=async(v=!1)=>{try{if(g(!0),b(null),!v){const D=localStorage.getItem(W);if(D)try{const j=JSON.parse(D);if(j.trend&&j.ages&&j.genderTrend){console.log("ðŸ“Š BFS Data loaded from Local Cache"),r(j.trend),h(j.ages),i(j.genderTrend),o(j.gender),n(!0),k(new Date(j.timestamp)),g(!1);return}}catch{localStorage.removeItem(W)}}const N=await fetch(ne);if(!N.ok)throw new Error(`HTTP error! status: ${N.status}`);const P=await N.arrayBuffer(),_=new TextDecoder("iso-8859-1").decode(P),S=ce(_);if(S){console.group("ðŸ“Š BFS Data Extraction");const D=de(S);r(D);const j=me(S);h(j);const B=xe(S);i(B);const U=he(S);o(U),console.groupEnd();const M={timestamp:Date.now(),trend:D,ages:j,genderTrend:B,gender:U};localStorage.setItem(W,JSON.stringify(M)),k(new Date),n(!0)}else throw new Error("Impossibile analizzare il file PX")}catch(N){console.error("BFS Fetch Error:",N),b(N.message||"Errore scaricamento dati BFS")}finally{g(!1)}};w.useEffect(()=>{R(!1)},[]);const G=a.length>0?a[a.length-1].frontalieri:0,C=a.length>1?a[a.length-2].frontalieri:0,T=C>0?((G-C)/C*100).toFixed(1):"0.0",O=(($=c.find(v=>v.name==="Uomini"))==null?void 0:$.percent)||"0";return e.jsxs("div",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/60 dark:border-slate-800 flex flex-col h-full animate-fade-in-up transition-colors duration-300 pb-8",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center sticky top-0 z-10 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md rounded-t-3xl",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-extrabold text-slate-800 dark:text-slate-100 tracking-tight flex items-center gap-2",children:[e.jsx(le,{size:20,className:"text-indigo-500"})," ",t("stats.title")]}),e.jsx("p",{className:"text-slate-500 dark:text-slate-500 text-xs mt-1",children:t("stats.source")})]}),x&&e.jsx("button",{onClick:()=>R(!0),disabled:f,className:"p-2 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 text-slate-500 hover:text-indigo-500 transition-all hover:rotate-180 disabled:opacity-50",title:t("stats.refreshData"),children:e.jsx(X,{size:18,className:f?"animate-spin":""})})]}),e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50/50 dark:bg-blue-900/20 p-4 rounded-2xl border border-blue-100 dark:border-blue-800 group relative",children:[e.jsxs("p",{className:"text-[10px] font-bold text-blue-500 uppercase flex items-center gap-1",children:[t("stats.totalFrontierWorkers"),e.jsx(y,{size:12,className:"text-blue-400 cursor-help"})]}),e.jsx("p",{className:"text-2xl font-extrabold text-slate-800 dark:text-slate-100 mt-1",children:f?e.jsx(I,{className:"animate-spin h-6 w-6"}):(G/1e3).toFixed(1)+"k"}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20 w-56",children:e.jsxs("div",{className:"bg-slate-900 text-white text-xs rounded-xl p-3 shadow-xl",children:[e.jsx("p",{className:"font-semibold mb-1",children:t("stats.totalTooltipTitle")}),e.jsx("p",{className:"text-slate-300",children:t("stats.totalTooltipDesc")}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-900"})]})})]}),e.jsxs("div",{className:`p-4 rounded-2xl border group relative ${Number(T)>=0?"bg-emerald-50/50 border-emerald-100 dark:bg-emerald-900/20 dark:border-emerald-800":"bg-red-50/50 border-red-100"}`,children:[e.jsxs("p",{className:`text-[10px] font-bold uppercase flex items-center gap-1 ${Number(T)>=0?"text-emerald-500":"text-red-500"}`,children:[t("stats.quarterlyTrend"),e.jsx(y,{size:12,className:`cursor-help ${Number(T)>=0?"text-emerald-400":"text-red-400"}`})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-2xl font-extrabold text-slate-800 dark:text-slate-100",children:[T,"%"]}),Number(T)>=0?e.jsx(z,{size:18,className:"text-emerald-500"}):e.jsx(z,{size:18,className:"text-red-500 rotate-180"})]}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20 w-56",children:e.jsxs("div",{className:"bg-slate-900 text-white text-xs rounded-xl p-3 shadow-xl",children:[e.jsx("p",{className:"font-semibold mb-1",children:t("stats.trendTooltipTitle")}),e.jsx("p",{className:"text-slate-300",children:t("stats.trendTooltipDesc")}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-900"})]})})]}),e.jsxs("div",{className:"bg-indigo-50/50 dark:bg-indigo-900/20 p-4 rounded-2xl border border-indigo-100 dark:border-indigo-800 group relative",children:[e.jsxs("p",{className:"text-[10px] font-bold text-indigo-500 uppercase flex items-center gap-1",children:[t("stats.permitsEstimated"),e.jsx(y,{size:12,className:"text-indigo-400 cursor-help"})]}),e.jsx("p",{className:"text-lg font-extrabold text-slate-800 dark:text-slate-100 mt-2 truncate",children:t("stats.permitG")}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20 w-56",children:e.jsxs("div",{className:"bg-slate-900 text-white text-xs rounded-xl p-3 shadow-xl",children:[e.jsx("p",{className:"font-semibold mb-1",children:t("stats.permitTooltipTitle")}),e.jsx("p",{className:"text-slate-300",children:t("stats.permitTooltipDesc")}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-900"})]})})]}),e.jsxs("div",{className:"bg-purple-50/50 dark:bg-purple-900/20 p-4 rounded-2xl border border-purple-100 dark:border-purple-800 group relative",children:[e.jsxs("p",{className:"text-[10px] font-bold text-purple-500 uppercase flex items-center gap-1",children:[t("stats.genderRatio"),e.jsx(y,{size:12,className:"text-purple-400 cursor-help"})]}),e.jsxs("div",{className:"flex items-end gap-1 mt-1",children:[e.jsxs("p",{className:"text-2xl font-extrabold text-slate-800 dark:text-slate-100",children:[O,"%"]}),e.jsx("span",{className:"text-xs text-slate-500 mb-1",children:"M"})]}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20 w-56",children:e.jsxs("div",{className:"bg-slate-900 text-white text-xs rounded-xl p-3 shadow-xl",children:[e.jsx("p",{className:"font-semibold mb-1",children:t("stats.genderTooltipTitle")}),e.jsx("p",{className:"text-slate-300",children:t("stats.genderTooltipDesc")}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-900"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-sm col-span-1 lg:col-span-2",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 dark:text-slate-200 mb-6 flex items-center gap-2",children:[e.jsx(z,{size:16,className:"text-blue-500"})," ",t("stats.historicalTrend")]}),e.jsx("div",{className:"h-[300px] w-full",children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(Y,{data:a,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorFront",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),e.jsx(E,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0",strokeOpacity:.3}),e.jsx(F,{dataKey:"year",axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"#94a3b8",fontWeight:600},dy:10,minTickGap:30}),e.jsx(K,{axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"#94a3b8",fontWeight:600},domain:["dataMin - 2000","auto"],width:50,tickFormatter:v=>`${(v/1e3).toFixed(0)}k`}),e.jsx(V,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},formatter:v=>[Number(v).toLocaleString("it-IT"),t("stats.workers")]}),e.jsx(Z,{type:"monotone",dataKey:"frontalieri",stroke:"#3b82f6",strokeWidth:3,fillOpacity:1,fill:"url(#colorFront)",animationDuration:1500})]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-sm",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 dark:text-slate-200 mb-6 flex items-center gap-2",children:[e.jsx(H,{size:16,className:"text-emerald-500"})," ",t("stats.ageDistribution")]}),e.jsx("div",{className:"h-[250px] w-full",children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(ee,{data:l,layout:"vertical",margin:{top:0,right:30,left:40,bottom:0},barSize:12,children:[e.jsx(E,{strokeDasharray:"3 3",horizontal:!0,vertical:!1,stroke:"#e2e8f0",strokeOpacity:.3}),e.jsx(F,{type:"number",hide:!0}),e.jsx(K,{dataKey:"name",type:"category",width:60,tick:{fontSize:10,fill:"#94a3b8",fontWeight:600},axisLine:!1,tickLine:!1}),e.jsx(V,{cursor:{fill:"transparent"},contentStyle:{borderRadius:"12px"}}),e.jsx(te,{dataKey:"value",radius:[0,4,4,0],fill:"#10b981",name:"Lavoratori",children:l.map((v,N)=>e.jsx(se,{fill:N%2===0?"#10b981":"#34d399"},`cell-${N}`))})]})})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-sm",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 dark:text-slate-200 mb-6 flex items-center gap-2",children:[e.jsx(J,{size:16,className:"text-indigo-500"})," ",t("stats.genderTrend")]}),e.jsx("div",{className:"h-[250px] w-full",children:d.length>0?e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(ae,{data:d,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx(E,{strokeDasharray:"3 3",vertical:!1,strokeOpacity:.2}),e.jsx(F,{dataKey:"year",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8"},dy:10,minTickGap:30}),e.jsx(K,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8"},width:45,tickFormatter:v=>`${(v/1e3).toFixed(0)}k`}),e.jsx(V,{contentStyle:{borderRadius:"12px"}}),e.jsx(re,{iconType:"circle",wrapperStyle:{fontSize:"10px",paddingTop:"10px"}}),e.jsx(Q,{type:"monotone",dataKey:"Uomini",stroke:"#3b82f6",strokeWidth:2,dot:!1,activeDot:{r:4}}),e.jsx(Q,{type:"monotone",dataKey:"Donne",stroke:"#ec4899",strokeWidth:2,dot:!1,activeDot:{r:4}})]})}):e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-500",children:f?e.jsx(I,{className:"animate-spin"}):e.jsx("span",{className:"text-xs italic",children:t("stats.dataNotAvailable")})})})]})]})]}),e.jsx("div",{className:"px-6",children:e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 p-4 rounded-2xl flex flex-col sm:flex-row items-center justify-between gap-4 border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white dark:bg-slate-700 p-2 rounded-xl text-indigo-500 shadow-sm hidden sm:block",children:e.jsx(y,{size:20})}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-500 leading-relaxed text-center sm:text-left",children:[t("stats.extractedFrom"),x?e.jsxs("span",{className:"text-emerald-600 dark:text-emerald-400 font-bold ml-1",children:[t("stats.lastUpdate"),": ",m==null?void 0:m.toLocaleDateString()]}):s&&e.jsx("span",{className:"text-red-500 ml-1",children:s})]})]}),e.jsxs("a",{href:ie,target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-700 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300 text-xs font-bold rounded-xl transition-all border border-slate-200 dark:border-slate-600 shadow-sm",children:[t("stats.sourceBFS")," ",e.jsx(oe,{size:12})]})]})})]})};export{ve as StatsView};
//# sourceMappingURL=StatsView-BpR27sDz.js.map
