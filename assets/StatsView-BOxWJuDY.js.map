{"version":3,"file":"StatsView-BOxWJuDY.js","sources":["../../components/StatsView.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { \n  AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, \n  Legend, PieChart, Pie, Cell, BarChart, Bar, LineChart, Line\n} from 'recharts';\nimport { TrendingUp, Users, Map, Briefcase, Info, ExternalLink, Loader2, AlertTriangle, Database, WifiOff, PersonStanding, CalendarClock, ArrowUpRight, ArrowDownRight, RefreshCw, BarChart2, Layers } from 'lucide-react';\nimport { useTranslation } from '@/services/i18n';\n\n// --- API CONFIGURATION ---\nconst BFS_MASTER_FILE_URL = \"https://dam-api.bfs.admin.ch/hub/api/dam/assets/36198674/master\";\nconst SOURCE_LINK = \"https://www.bfs.admin.ch/asset/it/px-x-0302010000_108\";\nconst CACHE_KEY = \"bfs_stats_cache\";\n\n// --- PX FILE PARSER & HELPERS ---\n\ninterface PXData {\n    dimensions: string[];\n    values: Record<string, string[]>;\n    data: number[];\n    dimensionMap: Record<string, number>;\n}\n\nconst parsePXFile = (raw: string): PXData | null => {\n    try {\n      const getValues = (key: string) => {\n        const regexQuoted = new RegExp(`VALUES\\\\([\"']?${key}[\"']?\\\\)=([^;]+?);`, 's');\n        let match = raw.match(regexQuoted);\n        if (!match) {\n          const regexSimple = new RegExp(`VALUES\\\\(${key.replace(/\"/g, '\\\\\"')}\\\\)=([^;]+?);`, 's');\n          match = raw.match(regexSimple);\n        }\n        if (!match) return [];\n        \n        const valStr = match[1].replace(/[\\r\\n]+/g, ' ').replace(/\\s+/g, ' ').trim();\n        return valStr.split(',').map(s => s.replace(/^[\"']|[\"']$/g, '').trim()).filter(Boolean);\n      };\n\n      const getKeyword = (key: string) => {\n        const regex = new RegExp(`${key}=([^;]+?);`, 's');\n        const match = raw.match(regex);\n        return match ? match[1].replace(/[\\r\\n\\t\\s]+/g, '').replace(/\"/g, '').split(',').map(s => s.trim()).filter(Boolean) : [];\n      };\n\n      const stub = getKeyword(\"STUB\");\n      const heading = getKeyword(\"HEADING\");\n      const dimensionNames = [...stub, ...heading];\n      \n      if (dimensionNames.length === 0) return null;\n\n      const dimensionMap: Record<string, number> = {};\n      const values: Record<string, string[]> = {};\n      dimensionNames.forEach((dim, idx) => {\n        dimensionMap[dim] = idx;\n        values[dim] = getValues(dim);\n      });\n\n      const dataMatch = raw.match(/DATA=([^;]+);/s);\n      if (!dataMatch) return null;\n      \n      const dataString = dataMatch[1].replace(/[\\s\\r\\n]+/g, ' ').trim();\n      const data = dataString.split(' ').map(v => {\n        if (v === '\".\"' || v === '.') return 0;\n        const num = parseFloat(v);\n        return isNaN(num) ? 0 : num;\n      });\n\n      return { dimensions: dimensionNames, values, data, dimensionMap };\n    } catch (e) {\n        console.error(\"PX Parsing Error\", e);\n        return null;\n    }\n};\n\nconst findDimKey = (px: PXData, ...candidates: string[]): string | undefined => {\n    return px.dimensions.find(d => candidates.some(c => d.toLowerCase().includes(c.toLowerCase())));\n};\n\nconst findValueKey = (px: PXData, dimName: string, ...candidates: string[]): string => {\n    if (!dimName || !px.values[dimName]) return px.values[dimName]?.[0] || '';\n    const values = px.values[dimName];\n    \n    const isLookingForTotal = candidates.some(c => c === '0' || c.toLowerCase().includes('total'));\n    if (isLookingForTotal) {\n        const totalCandidates = ['Total', 'Totale', 'totale', 'total', 'Total '];\n        for (const t of totalCandidates) {\n          const totalMatch = values.find(v => v.includes(t));\n          if (totalMatch) return totalMatch;\n        }\n        const codeTotal = values.find(v => v.startsWith('0 '));\n        if (codeTotal) return codeTotal;\n    }\n    \n    for (const c of candidates) {\n        const match = values.find(v => v === c || v.startsWith(c + ' '));\n        if (match) return match;\n    }\n\n    for (const c of candidates) {\n        const match = values.find(v => v.toLowerCase().includes(c.toLowerCase()));\n        if (match) return match;\n    }\n\n    return values[0];\n};\n\nconst getDataValue = (px: PXData, criteria: Record<string, string>): number => {\n    let index = 0;\n    let stride = 1;\n    \n    for (let i = px.dimensions.length - 1; i >= 0; i--) {\n        const dimName = px.dimensions[i];\n        const dimValues = px.values[dimName] || [];\n        const targetVal = criteria[dimName];\n        \n        let valIndex = 0; \n        if (targetVal) {\n           valIndex = dimValues.indexOf(targetVal);\n           if (valIndex === -1) valIndex = 0; \n        }\n        index += valIndex * stride;\n        stride *= dimValues.length;\n    }\n    return px.data[index] || 0;\n};\n\n// --- DATA EXTRACTORS ---\n\nconst extractTrend = (px: PXData) => {\n    const timeDim = findDimKey(px, \"Quartal\", \"Trimestre\", \"Time\");\n    const cantonDim = findDimKey(px, \"Kanton\", \"Cantone\", \"Region\", \"Arbeitskanton\");\n    const sexDim = findDimKey(px, \"Geschlecht\", \"Sesso\");\n    const sectorDim = findDimKey(px, \"Wirtschaftssektor\", \"Sezione\", \"Settore\");\n    const ageDim = findDimKey(px, \"Altersklasse\", \"Classe\", \"Et√†\");\n\n    if (!timeDim) return [];\n\n    const quarters = px.values[timeDim];\n    const result = [];\n\n    const cantonVal = findValueKey(px, cantonDim || \"\", \"21\", \"Ticino\");\n    const sexVal = findValueKey(px, sexDim || \"\", \"Total\", \"0\", \"Totale\");\n    const sectorVal = findValueKey(px, sectorDim || \"\", \"Total\", \"0\", \"Totale\");\n    const ageVal = findValueKey(px, ageDim || \"\", \"Total\", \"0\", \"Totale\");\n\n    const criteria: Record<string, string> = {\n        [cantonDim || \"Kanton\"]: cantonVal,\n        [sexDim || \"Geschlecht\"]: sexVal,\n        [sectorDim || \"Wirtschaftssektor\"]: sectorVal,\n        [ageDim || \"Altersklasse\"]: ageVal\n    };\n    \n    for (const q of quarters) {\n        criteria[timeDim] = q;\n        const val = getDataValue(px, criteria);\n        \n        let label = q;\n        const qMatch = q.match(/(\\d{4})[Q](\\d)/);\n        if (qMatch) label = `${qMatch[1]} Q${qMatch[2]}`;\n\n        result.push({ year: label, frontalieri: val });\n    }\n\n    return result.slice(-16);\n};\n\nconst extractAgeDistribution = (px: PXData) => {\n    const ageDim = findDimKey(px, \"Altersklasse\", \"Classe\", \"Et√†\");\n    const timeDim = findDimKey(px, \"Quartal\", \"Trimestre\");\n    const cantonDim = findDimKey(px, \"Kanton\", \"Cantone\", \"Arbeitskanton\");\n    const sexDim = findDimKey(px, \"Geschlecht\", \"Sesso\");\n    const sectorDim = findDimKey(px, \"Wirtschaftssektor\", \"Sezione\", \"Settore\");\n\n    if (!ageDim || !timeDim) return [];\n\n    const latestQuarter = px.values[timeDim][px.values[timeDim].length - 1];\n    const cantonVal = findValueKey(px, cantonDim || \"\", \"21\", \"Ticino\");\n    const sexVal = findValueKey(px, sexDim || \"\", \"Total\", \"0\");\n    const sectorVal = findValueKey(px, sectorDim || \"\", \"Total\", \"0\");\n\n    // Filter valid age groups (exclude Total)\n    const validAges = px.values[ageDim].filter(a => !a.toLowerCase().includes('total') && !a.startsWith('0'));\n\n    const result = validAges.map(age => {\n        const criteria = {\n            [cantonDim || \"Kanton\"]: cantonVal,\n            [sexDim || \"Geschlecht\"]: sexVal,\n            [sectorDim || \"Wirtschaftssektor\"]: sectorVal,\n            [timeDim]: latestQuarter,\n            [ageDim]: age\n        };\n        return { \n            name: age.replace(' anni', '').replace('Jahre', ''), \n            value: getDataValue(px, criteria) \n        };\n    });\n\n    return result.sort((a, b) => b.value - a.value);\n};\n\nconst extractGenderTrend = (px: PXData) => {\n    const sexDim = findDimKey(px, \"Geschlecht\", \"Sesso\");\n    const timeDim = findDimKey(px, \"Quartal\", \"Trimestre\");\n    const cantonDim = findDimKey(px, \"Kanton\", \"Cantone\", \"Arbeitskanton\");\n    const sectorDim = findDimKey(px, \"Wirtschaftssektor\", \"Sezione\", \"Settore\");\n    const ageDim = findDimKey(px, \"Altersklasse\", \"Classe\", \"Et√†\");\n\n    if (!sexDim || !timeDim) return [];\n\n    const quarters = px.values[timeDim].slice(-16); // Last 4 years\n    const cantonVal = findValueKey(px, cantonDim || \"\", \"21\", \"Ticino\");\n    const sectorVal = findValueKey(px, sectorDim || \"\", \"Total\", \"0\");\n    const ageVal = findValueKey(px, ageDim || \"\", \"Total\", \"0\");\n\n    // Find keys for Male and Female\n    const allSexes = px.values[sexDim];\n    const maleKey = allSexes.find(s => s.startsWith('1') || s.toLowerCase().includes('uomi') || s.toLowerCase().includes('mann'));\n    const femaleKey = allSexes.find(s => s.startsWith('2') || s.toLowerCase().includes('donne') || s.toLowerCase().includes('frau'));\n\n    if (!maleKey || !femaleKey) return [];\n\n    return quarters.map(q => {\n        let label = q;\n        const qMatch = q.match(/(\\d{4})[Q](\\d)/);\n        if (qMatch) label = `${qMatch[1]} Q${qMatch[2]}`;\n\n        const point: any = { year: label };\n        \n        // Male\n        point['Uomini'] = getDataValue(px, {\n            [cantonDim || \"Kanton\"]: cantonVal,\n            [sexDim]: maleKey,\n            [ageDim || \"Altersklasse\"]: ageVal,\n            [timeDim]: q,\n            [sectorDim || \"Wirtschaftssektor\"]: sectorVal\n        });\n\n        // Female\n        point['Donne'] = getDataValue(px, {\n            [cantonDim || \"Kanton\"]: cantonVal,\n            [sexDim]: femaleKey,\n            [ageDim || \"Altersklasse\"]: ageVal,\n            [timeDim]: q,\n            [sectorDim || \"Wirtschaftssektor\"]: sectorVal\n        });\n\n        return point;\n    });\n};\n\nconst extractGenderSnapshot = (px: PXData) => {\n    const sexDim = findDimKey(px, \"Geschlecht\", \"Sesso\");\n    const timeDim = findDimKey(px, \"Quartal\", \"Trimestre\");\n    const cantonDim = findDimKey(px, \"Kanton\", \"Cantone\", \"Arbeitskanton\");\n    const sectorDim = findDimKey(px, \"Wirtschaftssektor\", \"Sezione\", \"Settore\");\n    const ageDim = findDimKey(px, \"Altersklasse\", \"Classe\");\n\n    if (!sexDim || !timeDim) return [];\n\n    const latestQuarter = px.values[timeDim][px.values[timeDim].length - 1];\n    const cantonVal = findValueKey(px, cantonDim || \"\", \"21\", \"Ticino\");\n    const sectorVal = findValueKey(px, sectorDim || \"\", \"Total\", \"0\");\n    const ageVal = findValueKey(px, ageDim || \"\", \"Total\", \"0\");\n    \n    const validSexes = px.values[sexDim].filter(v => !v.startsWith(\"0\") && !v.toLowerCase().includes(\"total\"));\n\n    const result = validSexes.map(sexVal => {\n        const criteria: Record<string, string> = {\n            [cantonDim || \"Kanton\"]: cantonVal,\n            [sectorDim || \"Wirtschaftssektor\"]: sectorVal,\n            [ageDim || \"Altersklasse\"]: ageVal,\n            [timeDim]: latestQuarter,\n            [sexDim]: sexVal\n        };\n        \n        let name = sexVal;\n        if (name.includes(\"1\") || name.toLowerCase().includes(\"uomi\") || name.toLowerCase().includes(\"mann\")) name = \"Uomini\";\n        if (name.includes(\"2\") || name.toLowerCase().includes(\"donn\") || name.toLowerCase().includes(\"frau\")) name = \"Donne\";\n\n        return { \n            name: name, \n            value: getDataValue(px, criteria), \n            color: name === \"Uomini\" ? \"#3b82f6\" : \"#ec4899\" \n        };\n    }).sort((a, b) => b.value - a.value);\n\n    // Calculate percentages\n    const total = result.reduce((sum, item) => sum + item.value, 0);\n    return result.map(item => ({\n        ...item,\n        percent: total > 0 ? (item.value / total * 100).toFixed(1) : \"0\"\n    }));\n}\n\nexport const StatsView: React.FC = () => {\n  const { t } = useTranslation();\n  const [historicalData, setHistoricalData] = useState<any[]>([]);\n  const [ageData, setAgeData] = useState<any[]>([]);\n  const [genderTrendData, setGenderTrendData] = useState<any[]>([]);\n  const [genderData, setGenderData] = useState<any[]>([]);\n  \n  const [loading, setLoading] = useState(true);\n  const [usingRealData, setUsingRealData] = useState(false);\n  const [apiError, setApiError] = useState<string | null>(null);\n  const [lastUpdated, setLastUpdated] = useState<Date | null>(null);\n\n  const fetchBFSData = async (forceRefresh = false) => {\n    try {\n      setLoading(true);\n      setApiError(null);\n      \n      // 1. Check LocalStorage Cache\n      if (!forceRefresh) {\n          const cached = localStorage.getItem(CACHE_KEY);\n          if (cached) {\n              try {\n                  const parsed = JSON.parse(cached);\n                  // Ensure we have the new field genderTrend, otherwise re-fetch\n                  if (parsed.trend && parsed.ages && parsed.genderTrend) {\n                      console.log(\"üìä BFS Data loaded from Local Cache\");\n                      setHistoricalData(parsed.trend);\n                      setAgeData(parsed.ages);\n                      setGenderTrendData(parsed.genderTrend);\n                      setGenderData(parsed.gender);\n                      setUsingRealData(true);\n                      setLastUpdated(new Date(parsed.timestamp));\n                      setLoading(false);\n                      return;\n                  }\n              } catch (e) {\n                  localStorage.removeItem(CACHE_KEY);\n              }\n          }\n      }\n\n      // 2. Fetch Remote\n      const response = await fetch(BFS_MASTER_FILE_URL);\n      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\n      \n      const buffer = await response.arrayBuffer();\n      const decoder = new TextDecoder('iso-8859-1');\n      const text = decoder.decode(buffer);\n\n      const pxData = parsePXFile(text);\n      \n      if (pxData) {\n          console.group(\"üìä BFS Data Extraction\");\n          \n          const trend = extractTrend(pxData);\n          setHistoricalData(trend);\n          \n          const ages = extractAgeDistribution(pxData);\n          setAgeData(ages);\n          \n          const genderTrend = extractGenderTrend(pxData);\n          setGenderTrendData(genderTrend);\n\n          const genders = extractGenderSnapshot(pxData);\n          setGenderData(genders);\n          \n          console.groupEnd();\n\n          // Save to Cache\n          const cachePayload = {\n              timestamp: Date.now(),\n              trend,\n              ages,\n              genderTrend,\n              gender: genders\n          };\n          localStorage.setItem(CACHE_KEY, JSON.stringify(cachePayload));\n          setLastUpdated(new Date());\n\n          setUsingRealData(true);\n      } else {\n          throw new Error(\"Impossibile analizzare il file PX\");\n      }\n\n    } catch (error: any) {\n      console.error(\"BFS Fetch Error:\", error);\n      setApiError(error.message || \"Errore scaricamento dati BFS\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchBFSData(false);\n  }, []);\n\n  // --- KPI CALCULATIONS ---\n  const latestValue = historicalData.length > 0 ? historicalData[historicalData.length - 1].frontalieri : 0;\n  const prevValue = historicalData.length > 1 ? historicalData[historicalData.length - 2].frontalieri : 0;\n  const qoqPercent = prevValue > 0 ? (((latestValue - prevValue) / prevValue) * 100).toFixed(1) : \"0.0\";\n  const malePercent = genderData.find(g => g.name === 'Uomini')?.percent || \"0\";\n\n  return (\n    <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/60 dark:border-slate-800 flex flex-col h-full animate-fade-in-up transition-colors duration-300 pb-8\">\n       {/* Header */}\n       <div className=\"p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center sticky top-0 z-10 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md rounded-t-3xl\">\n          <div>\n            <h2 className=\"text-xl font-extrabold text-slate-800 dark:text-slate-100 tracking-tight flex items-center gap-2\">\n              <Database size={20} className=\"text-indigo-500\"/> {t('stats.title')}\n            </h2>\n            <p className=\"text-slate-500 dark:text-slate-500 text-xs mt-1\">\n              {t('stats.source')}\n            </p>\n          </div>\n          \n          {usingRealData && (\n            <button \n                onClick={() => fetchBFSData(true)}\n                disabled={loading}\n                className=\"p-2 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 text-slate-500 hover:text-indigo-500 transition-all hover:rotate-180 disabled:opacity-50\"\n                title={t('stats.refreshData')}\n            >\n                <RefreshCw size={18} className={loading ? \"animate-spin\" : \"\"} />\n            </button>\n          )}\n      </div>\n\n      <div className=\"p-6 space-y-8\">\n        \n        {/* KPI Row */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"bg-blue-50/50 dark:bg-blue-900/20 p-4 rounded-2xl border border-blue-100 dark:border-blue-800 group relative\">\n               <p className=\"text-[10px] font-bold text-blue-500 uppercase flex items-center gap-1\">\n                 {t('stats.totalFrontierWorkers')}\n                 <Info size={12} className=\"text-blue-400 cursor-help\" />\n               </p>\n               <p className=\"text-2xl font-extrabold text-slate-800 dark:text-slate-100 mt-1\">\n                 {loading ? <Loader2 className=\"animate-spin h-6 w-6\"/> : (latestValue / 1000).toFixed(1) + 'k'}\n               </p>\n               {/* Tooltip */}\n               <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20 w-56\">\n                 <div className=\"bg-slate-900 text-white text-xs rounded-xl p-3 shadow-xl\">\n                   <p className=\"font-semibold mb-1\">{t('stats.totalTooltipTitle')}</p>\n                   <p className=\"text-slate-300\">{t('stats.totalTooltipDesc')}</p>\n                   <div className=\"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-900\"></div>\n                 </div>\n               </div>\n            </div>\n            <div className={`p-4 rounded-2xl border group relative ${Number(qoqPercent) >= 0 ? 'bg-emerald-50/50 border-emerald-100 dark:bg-emerald-900/20 dark:border-emerald-800' : 'bg-red-50/50 border-red-100'}`}>\n               <p className={`text-[10px] font-bold uppercase flex items-center gap-1 ${Number(qoqPercent) >= 0 ? 'text-emerald-500' : 'text-red-500'}`}>\n                 {t('stats.quarterlyTrend')}\n                 <Info size={12} className={`cursor-help ${Number(qoqPercent) >= 0 ? 'text-emerald-400' : 'text-red-400'}`} />\n               </p>\n               <div className=\"flex items-center gap-2 mt-1\">\n                 <p className=\"text-2xl font-extrabold text-slate-800 dark:text-slate-100\">{qoqPercent}%</p>\n                 {Number(qoqPercent) >= 0 ? <TrendingUp size={18} className=\"text-emerald-500\"/> : <TrendingUp size={18} className=\"text-red-500 rotate-180\"/>}\n               </div>\n               {/* Tooltip */}\n               <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20 w-56\">\n                 <div className=\"bg-slate-900 text-white text-xs rounded-xl p-3 shadow-xl\">\n                   <p className=\"font-semibold mb-1\">{t('stats.trendTooltipTitle')}</p>\n                   <p className=\"text-slate-300\">{t('stats.trendTooltipDesc')}</p>\n                   <div className=\"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-900\"></div>\n                 </div>\n               </div>\n            </div>\n            <div className=\"bg-indigo-50/50 dark:bg-indigo-900/20 p-4 rounded-2xl border border-indigo-100 dark:border-indigo-800 group relative\">\n               <p className=\"text-[10px] font-bold text-indigo-500 uppercase flex items-center gap-1\">\n                 {t('stats.permitsEstimated')}\n                 <Info size={12} className=\"text-indigo-400 cursor-help\" />\n               </p>\n               <p className=\"text-lg font-extrabold text-slate-800 dark:text-slate-100 mt-2 truncate\">{t('stats.permitG')}</p>\n               {/* Tooltip */}\n               <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20 w-56\">\n                 <div className=\"bg-slate-900 text-white text-xs rounded-xl p-3 shadow-xl\">\n                   <p className=\"font-semibold mb-1\">{t('stats.permitTooltipTitle')}</p>\n                   <p className=\"text-slate-300\">{t('stats.permitTooltipDesc')}</p>\n                   <div className=\"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-900\"></div>\n                 </div>\n               </div>\n            </div>\n            <div className=\"bg-purple-50/50 dark:bg-purple-900/20 p-4 rounded-2xl border border-purple-100 dark:border-purple-800 group relative\">\n               <p className=\"text-[10px] font-bold text-purple-500 uppercase flex items-center gap-1\">\n                 {t('stats.genderRatio')}\n                 <Info size={12} className=\"text-purple-400 cursor-help\" />\n               </p>\n               <div className=\"flex items-end gap-1 mt-1\">\n                  <p className=\"text-2xl font-extrabold text-slate-800 dark:text-slate-100\">{malePercent}%</p>\n                  <span className=\"text-xs text-slate-500 mb-1\">M</span>\n               </div>\n               {/* Tooltip */}\n               <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20 w-56\">\n                 <div className=\"bg-slate-900 text-white text-xs rounded-xl p-3 shadow-xl\">\n                   <p className=\"font-semibold mb-1\">{t('stats.genderTooltipTitle')}</p>\n                   <p className=\"text-slate-300\">{t('stats.genderTooltipDesc')}</p>\n                   <div className=\"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-900\"></div>\n                 </div>\n               </div>\n            </div>\n        </div>\n\n        {/* Chart Grid */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            \n            {/* Chart 1: Historical Trend */}\n            <div className=\"bg-white dark:bg-slate-800 p-5 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-sm col-span-1 lg:col-span-2\">\n               <h3 className=\"text-sm font-bold text-slate-700 dark:text-slate-200 mb-6 flex items-center gap-2\">\n                 <TrendingUp size={16} className=\"text-blue-500\"/> {t('stats.historicalTrend')}\n               </h3>\n               <div className=\"h-[300px] w-full\">\n                 <ResponsiveContainer width=\"100%\" height=\"100%\">\n                   <AreaChart data={historicalData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n                     <defs>\n                       <linearGradient id=\"colorFront\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                         <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.3}/>\n                         <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0}/>\n                       </linearGradient>\n                     </defs>\n                     <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e2e8f0\" strokeOpacity={0.3} />\n                     <XAxis dataKey=\"year\" axisLine={false} tickLine={false} tick={{fontSize: 11, fill: '#94a3b8', fontWeight: 600}} dy={10} minTickGap={30} />\n                     <YAxis axisLine={false} tickLine={false} tick={{fontSize: 11, fill: '#94a3b8', fontWeight: 600}} domain={['dataMin - 2000', 'auto']} width={50} tickFormatter={(val) => `${(val/1000).toFixed(0)}k`} />\n                     <Tooltip \n                        contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)'}}\n                        formatter={(value: any) => [Number(value).toLocaleString('it-IT'), t('stats.workers')]}\n                     />\n                     <Area type=\"monotone\" dataKey=\"frontalieri\" stroke=\"#3b82f6\" strokeWidth={3} fillOpacity={1} fill=\"url(#colorFront)\" animationDuration={1500} />\n                   </AreaChart>\n                 </ResponsiveContainer>\n               </div>\n            </div>\n\n            {/* Chart 2: Age Distribution */}\n            <div className=\"bg-white dark:bg-slate-800 p-5 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-sm\">\n               <h3 className=\"text-sm font-bold text-slate-700 dark:text-slate-200 mb-6 flex items-center gap-2\">\n                 <BarChart2 size={16} className=\"text-emerald-500\"/> {t('stats.ageDistribution')}\n               </h3>\n               <div className=\"h-[250px] w-full\">\n                 <ResponsiveContainer width=\"100%\" height=\"100%\">\n                   <BarChart data={ageData} layout=\"vertical\" margin={{ top: 0, right: 30, left: 40, bottom: 0 }} barSize={12}>\n                     <CartesianGrid strokeDasharray=\"3 3\" horizontal={true} vertical={false} stroke=\"#e2e8f0\" strokeOpacity={0.3} />\n                     <XAxis type=\"number\" hide />\n                     <YAxis dataKey=\"name\" type=\"category\" width={60} tick={{fontSize: 10, fill: '#94a3b8', fontWeight: 600}} axisLine={false} tickLine={false} />\n                     <Tooltip cursor={{fill: 'transparent'}} contentStyle={{borderRadius: '12px'}} />\n                     <Bar dataKey=\"value\" radius={[0, 4, 4, 0]} fill=\"#10b981\" name=\"Lavoratori\">\n                        {ageData.map((entry, index) => (\n                            <Cell key={`cell-${index}`} fill={index % 2 === 0 ? '#10b981' : '#34d399'} />\n                        ))}\n                     </Bar>\n                   </BarChart>\n                 </ResponsiveContainer>\n               </div>\n            </div>\n\n            {/* Chart 3: Gender Trend (Replacing Broken Sectors) */}\n            <div className=\"bg-white dark:bg-slate-800 p-5 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-sm\">\n               <h3 className=\"text-sm font-bold text-slate-700 dark:text-slate-200 mb-6 flex items-center gap-2\">\n                 <PersonStanding size={16} className=\"text-indigo-500\"/> {t('stats.genderTrend')}\n               </h3>\n               <div className=\"h-[250px] w-full\">\n                 {genderTrendData.length > 0 ? (\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        <LineChart data={genderTrendData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n                            <CartesianGrid strokeDasharray=\"3 3\" vertical={false} strokeOpacity={0.2} />\n                            <XAxis dataKey=\"year\" axisLine={false} tickLine={false} tick={{fontSize: 10, fill: '#94a3b8'}} dy={10} minTickGap={30} />\n                            <YAxis axisLine={false} tickLine={false} tick={{fontSize: 10, fill: '#94a3b8'}} width={45} tickFormatter={(val) => `${(val/1000).toFixed(0)}k`} />\n                            <Tooltip contentStyle={{borderRadius: '12px'}} />\n                            <Legend iconType=\"circle\" wrapperStyle={{fontSize: '10px', paddingTop: '10px'}}/>\n                            <Line type=\"monotone\" dataKey=\"Uomini\" stroke=\"#3b82f6\" strokeWidth={2} dot={false} activeDot={{r: 4}} />\n                            <Line type=\"monotone\" dataKey=\"Donne\" stroke=\"#ec4899\" strokeWidth={2} dot={false} activeDot={{r: 4}} />\n                        </LineChart>\n                    </ResponsiveContainer>\n                 ) : (\n                    <div className=\"w-full h-full flex flex-col items-center justify-center text-slate-500\">\n                        {loading ? <Loader2 className=\"animate-spin\" /> : <span className=\"text-xs italic\">{t('stats.dataNotAvailable')}</span>}\n                    </div>\n                 )}\n               </div>\n            </div>\n\n        </div>\n\n      </div>\n\n      {/* Footer Info */}\n      <div className=\"px-6\">\n        <div className=\"bg-slate-50 dark:bg-slate-800/50 p-4 rounded-2xl flex flex-col sm:flex-row items-center justify-between gap-4 border border-slate-100 dark:border-slate-700\">\n            <div className=\"flex items-center gap-3\">\n                <div className=\"bg-white dark:bg-slate-700 p-2 rounded-xl text-indigo-500 shadow-sm hidden sm:block\">\n                    <Info size={20} />\n                </div>\n                <div className=\"text-xs text-slate-500 dark:text-slate-500 leading-relaxed text-center sm:text-left\">\n                    {t('stats.extractedFrom')}\n                    {usingRealData ? (\n                        <span className=\"text-emerald-600 dark:text-emerald-400 font-bold ml-1\">\n                            {t('stats.lastUpdate')}: {lastUpdated?.toLocaleDateString()}\n                        </span>\n                    ) : (\n                        apiError && <span className=\"text-red-500 ml-1\">{apiError}</span>\n                    )}\n                </div>\n            </div>\n            <a \n            href={SOURCE_LINK}\n            target=\"_blank\" \n            rel=\"noreferrer\"\n            className=\"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-700 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300 text-xs font-bold rounded-xl transition-all border border-slate-200 dark:border-slate-600 shadow-sm\"\n            >\n            {t('stats.sourceBFS')} <ExternalLink size={12} />\n            </a>\n        </div>\n      </div>\n\n    </div>\n  );\n};"],"names":["BFS_MASTER_FILE_URL","SOURCE_LINK","CACHE_KEY","parsePXFile","raw","getValues","key","regexQuoted","match","regexSimple","s","getKeyword","regex","stub","heading","dimensionNames","dimensionMap","values","dim","idx","dataMatch","data","v","num","e","findDimKey","px","candidates","d","c","findValueKey","dimName","_a","totalCandidates","t","totalMatch","codeTotal","getDataValue","criteria","index","stride","i","dimValues","targetVal","valIndex","extractTrend","timeDim","cantonDim","sexDim","sectorDim","ageDim","quarters","result","cantonVal","sexVal","sectorVal","ageVal","q","val","label","qMatch","extractAgeDistribution","latestQuarter","a","age","b","extractGenderTrend","allSexes","maleKey","femaleKey","point","extractGenderSnapshot","name","total","sum","item","StatsView","useTranslation","historicalData","setHistoricalData","useState","ageData","setAgeData","genderTrendData","setGenderTrendData","genderData","setGenderData","loading","setLoading","usingRealData","setUsingRealData","apiError","setApiError","lastUpdated","setLastUpdated","fetchBFSData","forceRefresh","cached","parsed","response","buffer","text","pxData","trend","ages","genderTrend","genders","cachePayload","error","useEffect","latestValue","prevValue","qoqPercent","malePercent","g","jsxs","jsx","Database","RefreshCw","Info","Loader2","TrendingUp","ResponsiveContainer","AreaChart","CartesianGrid","XAxis","YAxis","Tooltip","value","Area","BarChart2","BarChart","Bar","entry","Cell","PersonStanding","LineChart","Legend","Line","ExternalLink"],"mappings":"6YASA,MAAMA,GAAsB,kEACtBC,GAAc,wDACdC,EAAY,kBAWZC,GAAeC,GAA+B,CAChD,GAAI,CACF,MAAMC,EAAaC,GAAgB,CACjC,MAAMC,EAAc,IAAI,OAAO,iBAAiBD,CAAG,qBAAsB,GAAG,EAC5E,IAAIE,EAAQJ,EAAI,MAAMG,CAAW,EACjC,GAAI,CAACC,EAAO,CACV,MAAMC,EAAc,IAAI,OAAO,YAAYH,EAAI,QAAQ,KAAM,KAAK,CAAC,gBAAiB,GAAG,EACvFE,EAAQJ,EAAI,MAAMK,CAAW,CAC/B,CACA,OAAKD,EAEUA,EAAM,CAAC,EAAE,QAAQ,WAAY,GAAG,EAAE,QAAQ,OAAQ,GAAG,EAAE,KAAA,EACxD,MAAM,GAAG,EAAE,IAAIE,GAAKA,EAAE,QAAQ,eAAgB,EAAE,EAAE,KAAA,CAAM,EAAE,OAAO,OAAO,EAHnE,CAAA,CAIrB,EAEMC,EAAcL,GAAgB,CAClC,MAAMM,EAAQ,IAAI,OAAO,GAAGN,CAAG,aAAc,GAAG,EAC1CE,EAAQJ,EAAI,MAAMQ,CAAK,EAC7B,OAAOJ,EAAQA,EAAM,CAAC,EAAE,QAAQ,eAAgB,EAAE,EAAE,QAAQ,KAAM,EAAE,EAAE,MAAM,GAAG,EAAE,IAAIE,GAAKA,EAAE,KAAA,CAAM,EAAE,OAAO,OAAO,EAAI,CAAA,CACxH,EAEMG,EAAOF,EAAW,MAAM,EACxBG,EAAUH,EAAW,SAAS,EAC9BI,EAAiB,CAAC,GAAGF,EAAM,GAAGC,CAAO,EAE3C,GAAIC,EAAe,SAAW,EAAG,OAAO,KAExC,MAAMC,EAAuC,CAAA,EACvCC,EAAmC,CAAA,EACzCF,EAAe,QAAQ,CAACG,EAAKC,IAAQ,CACnCH,EAAaE,CAAG,EAAIC,EACpBF,EAAOC,CAAG,EAAIb,EAAUa,CAAG,CAC7B,CAAC,EAED,MAAME,EAAYhB,EAAI,MAAM,gBAAgB,EAC5C,GAAI,CAACgB,EAAW,OAAO,KAGvB,MAAMC,EADaD,EAAU,CAAC,EAAE,QAAQ,aAAc,GAAG,EAAE,KAAA,EACnC,MAAM,GAAG,EAAE,IAAIE,GAAK,CAC1C,GAAIA,IAAM,OAASA,IAAM,IAAK,MAAO,GACrC,MAAMC,EAAM,WAAWD,CAAC,EACxB,OAAO,MAAMC,CAAG,EAAI,EAAIA,CAC1B,CAAC,EAED,MAAO,CAAE,WAAYR,EAAgB,OAAAE,EAAQ,KAAAI,EAAM,aAAAL,CAAA,CACrD,OAASQ,EAAG,CACR,eAAQ,MAAM,mBAAoBA,CAAC,EAC5B,IACX,CACJ,EAEMC,EAAa,CAACC,KAAeC,IACxBD,EAAG,WAAW,KAAKE,GAAKD,EAAW,KAAKE,GAAKD,EAAE,YAAA,EAAc,SAASC,EAAE,YAAA,CAAa,CAAC,CAAC,EAG5FC,EAAe,CAACJ,EAAYK,KAAoBJ,IAAiC,OACnF,GAAI,CAACI,GAAW,CAACL,EAAG,OAAOK,CAAO,EAAG,QAAOC,EAAAN,EAAG,OAAOK,CAAO,IAAjB,YAAAC,EAAqB,KAAM,GACvE,MAAMf,EAASS,EAAG,OAAOK,CAAO,EAGhC,GAD0BJ,EAAW,KAAKE,GAAKA,IAAM,KAAOA,EAAE,YAAA,EAAc,SAAS,OAAO,CAAC,EACtE,CACnB,MAAMI,EAAkB,CAAC,QAAS,SAAU,SAAU,QAAS,QAAQ,EACvE,UAAWC,KAAKD,EAAiB,CAC/B,MAAME,EAAalB,EAAO,QAAUK,EAAE,SAASY,CAAC,CAAC,EACjD,GAAIC,EAAY,OAAOA,CACzB,CACA,MAAMC,EAAYnB,EAAO,QAAUK,EAAE,WAAW,IAAI,CAAC,EACrD,GAAIc,EAAW,OAAOA,CAC1B,CAEA,UAAWP,KAAKF,EAAY,CACxB,MAAMnB,EAAQS,EAAO,KAAKK,GAAKA,IAAMO,GAAKP,EAAE,WAAWO,EAAI,GAAG,CAAC,EAC/D,GAAIrB,EAAO,OAAOA,CACtB,CAEA,UAAWqB,KAAKF,EAAY,CACxB,MAAMnB,EAAQS,EAAO,KAAKK,GAAKA,EAAE,YAAA,EAAc,SAASO,EAAE,YAAA,CAAa,CAAC,EACxE,GAAIrB,EAAO,OAAOA,CACtB,CAEA,OAAOS,EAAO,CAAC,CACnB,EAEMoB,EAAe,CAACX,EAAYY,IAA6C,CAC3E,IAAIC,EAAQ,EACRC,EAAS,EAEb,QAASC,EAAIf,EAAG,WAAW,OAAS,EAAGe,GAAK,EAAGA,IAAK,CAChD,MAAMV,EAAUL,EAAG,WAAWe,CAAC,EACzBC,EAAYhB,EAAG,OAAOK,CAAO,GAAK,CAAA,EAClCY,EAAYL,EAASP,CAAO,EAElC,IAAIa,EAAW,EACXD,IACDC,EAAWF,EAAU,QAAQC,CAAS,EAClCC,IAAa,KAAIA,EAAW,IAEnCL,GAASK,EAAWJ,EACpBA,GAAUE,EAAU,MACxB,CACA,OAAOhB,EAAG,KAAKa,CAAK,GAAK,CAC7B,EAIMM,GAAgBnB,GAAe,CACjC,MAAMoB,EAAUrB,EAAWC,EAAI,UAAW,YAAa,MAAM,EACvDqB,EAAYtB,EAAWC,EAAI,SAAU,UAAW,SAAU,eAAe,EACzEsB,EAASvB,EAAWC,EAAI,aAAc,OAAO,EAC7CuB,EAAYxB,EAAWC,EAAI,oBAAqB,UAAW,SAAS,EACpEwB,EAASzB,EAAWC,EAAI,eAAgB,SAAU,KAAK,EAE7D,GAAI,CAACoB,EAAS,MAAO,CAAA,EAErB,MAAMK,EAAWzB,EAAG,OAAOoB,CAAO,EAC5BM,EAAS,CAAA,EAETC,EAAYvB,EAAaJ,EAAIqB,GAAa,GAAI,KAAM,QAAQ,EAC5DO,EAASxB,EAAaJ,EAAIsB,GAAU,GAAI,QAAS,IAAK,QAAQ,EAC9DO,EAAYzB,EAAaJ,EAAIuB,GAAa,GAAI,QAAS,IAAK,QAAQ,EACpEO,EAAS1B,EAAaJ,EAAIwB,GAAU,GAAI,QAAS,IAAK,QAAQ,EAE9DZ,EAAmC,CACrC,CAACS,GAAa,QAAQ,EAAGM,EACzB,CAACL,GAAU,YAAY,EAAGM,EAC1B,CAACL,GAAa,mBAAmB,EAAGM,EACpC,CAACL,GAAU,cAAc,EAAGM,CAAA,EAGhC,UAAWC,KAAKN,EAAU,CACtBb,EAASQ,CAAO,EAAIW,EACpB,MAAMC,EAAMrB,EAAaX,EAAIY,CAAQ,EAErC,IAAIqB,EAAQF,EACZ,MAAMG,EAASH,EAAE,MAAM,gBAAgB,EACnCG,MAAgB,GAAGA,EAAO,CAAC,CAAC,KAAKA,EAAO,CAAC,CAAC,IAE9CR,EAAO,KAAK,CAAE,KAAMO,EAAO,YAAaD,EAAK,CACjD,CAEA,OAAON,EAAO,MAAM,GAAG,CAC3B,EAEMS,GAA0BnC,GAAe,CAC3C,MAAMwB,EAASzB,EAAWC,EAAI,eAAgB,SAAU,KAAK,EACvDoB,EAAUrB,EAAWC,EAAI,UAAW,WAAW,EAC/CqB,EAAYtB,EAAWC,EAAI,SAAU,UAAW,eAAe,EAC/DsB,EAASvB,EAAWC,EAAI,aAAc,OAAO,EAC7CuB,EAAYxB,EAAWC,EAAI,oBAAqB,UAAW,SAAS,EAE1E,GAAI,CAACwB,GAAU,CAACJ,QAAgB,CAAA,EAEhC,MAAMgB,EAAgBpC,EAAG,OAAOoB,CAAO,EAAEpB,EAAG,OAAOoB,CAAO,EAAE,OAAS,CAAC,EAChEO,EAAYvB,EAAaJ,EAAIqB,GAAa,GAAI,KAAM,QAAQ,EAC5DO,EAASxB,EAAaJ,EAAIsB,GAAU,GAAI,QAAS,GAAG,EACpDO,EAAYzB,EAAaJ,EAAIuB,GAAa,GAAI,QAAS,GAAG,EAmBhE,OAhBkBvB,EAAG,OAAOwB,CAAM,EAAE,UAAY,CAACa,EAAE,YAAA,EAAc,SAAS,OAAO,GAAK,CAACA,EAAE,WAAW,GAAG,CAAC,EAE/E,IAAIC,GAAO,CAChC,MAAM1B,EAAW,CACb,CAACS,GAAa,QAAQ,EAAGM,EACzB,CAACL,GAAU,YAAY,EAAGM,EAC1B,CAACL,GAAa,mBAAmB,EAAGM,EACpC,CAACT,CAAO,EAAGgB,EACX,CAACZ,CAAM,EAAGc,CAAA,EAEd,MAAO,CACH,KAAMA,EAAI,QAAQ,QAAS,EAAE,EAAE,QAAQ,QAAS,EAAE,EAClD,MAAO3B,EAAaX,EAAIY,CAAQ,CAAA,CAExC,CAAC,EAEa,KAAK,CAACyB,EAAGE,IAAMA,EAAE,MAAQF,EAAE,KAAK,CAClD,EAEMG,GAAsBxC,GAAe,CACvC,MAAMsB,EAASvB,EAAWC,EAAI,aAAc,OAAO,EAC7CoB,EAAUrB,EAAWC,EAAI,UAAW,WAAW,EAC/CqB,EAAYtB,EAAWC,EAAI,SAAU,UAAW,eAAe,EAC/DuB,EAAYxB,EAAWC,EAAI,oBAAqB,UAAW,SAAS,EACpEwB,EAASzB,EAAWC,EAAI,eAAgB,SAAU,KAAK,EAE7D,GAAI,CAACsB,GAAU,CAACF,QAAgB,CAAA,EAEhC,MAAMK,EAAWzB,EAAG,OAAOoB,CAAO,EAAE,MAAM,GAAG,EACvCO,EAAYvB,EAAaJ,EAAIqB,GAAa,GAAI,KAAM,QAAQ,EAC5DQ,EAAYzB,EAAaJ,EAAIuB,GAAa,GAAI,QAAS,GAAG,EAC1DO,EAAS1B,EAAaJ,EAAIwB,GAAU,GAAI,QAAS,GAAG,EAGpDiB,EAAWzC,EAAG,OAAOsB,CAAM,EAC3BoB,EAAUD,EAAS,QAAU,EAAE,WAAW,GAAG,GAAK,EAAE,cAAc,SAAS,MAAM,GAAK,EAAE,cAAc,SAAS,MAAM,CAAC,EACtHE,EAAYF,EAAS,QAAU,EAAE,WAAW,GAAG,GAAK,EAAE,cAAc,SAAS,OAAO,GAAK,EAAE,cAAc,SAAS,MAAM,CAAC,EAE/H,MAAI,CAACC,GAAW,CAACC,EAAkB,CAAA,EAE5BlB,EAAS,IAAIM,GAAK,CACrB,IAAIE,EAAQF,EACZ,MAAMG,EAASH,EAAE,MAAM,gBAAgB,EACnCG,MAAgB,GAAGA,EAAO,CAAC,CAAC,KAAKA,EAAO,CAAC,CAAC,IAE9C,MAAMU,EAAa,CAAE,KAAMX,CAAA,EAG3B,OAAAW,EAAM,OAAYjC,EAAaX,EAAI,CAC/B,CAACqB,GAAa,QAAQ,EAAGM,EACzB,CAACL,CAAM,EAAGoB,EACV,CAAClB,GAAU,cAAc,EAAGM,EAC5B,CAACV,CAAO,EAAGW,EACX,CAACR,GAAa,mBAAmB,EAAGM,CAAA,CACvC,EAGDe,EAAM,MAAWjC,EAAaX,EAAI,CAC9B,CAACqB,GAAa,QAAQ,EAAGM,EACzB,CAACL,CAAM,EAAGqB,EACV,CAACnB,GAAU,cAAc,EAAGM,EAC5B,CAACV,CAAO,EAAGW,EACX,CAACR,GAAa,mBAAmB,EAAGM,CAAA,CACvC,EAEMe,CACX,CAAC,CACL,EAEMC,GAAyB7C,GAAe,CAC1C,MAAMsB,EAASvB,EAAWC,EAAI,aAAc,OAAO,EAC7CoB,EAAUrB,EAAWC,EAAI,UAAW,WAAW,EAC/CqB,EAAYtB,EAAWC,EAAI,SAAU,UAAW,eAAe,EAC/DuB,EAAYxB,EAAWC,EAAI,oBAAqB,UAAW,SAAS,EACpEwB,EAASzB,EAAWC,EAAI,eAAgB,QAAQ,EAEtD,GAAI,CAACsB,GAAU,CAACF,QAAgB,CAAA,EAEhC,MAAMgB,EAAgBpC,EAAG,OAAOoB,CAAO,EAAEpB,EAAG,OAAOoB,CAAO,EAAE,OAAS,CAAC,EAChEO,EAAYvB,EAAaJ,EAAIqB,GAAa,GAAI,KAAM,QAAQ,EAC5DQ,EAAYzB,EAAaJ,EAAIuB,GAAa,GAAI,QAAS,GAAG,EAC1DO,EAAS1B,EAAaJ,EAAIwB,GAAU,GAAI,QAAS,GAAG,EAIpDE,EAFa1B,EAAG,OAAOsB,CAAM,EAAE,UAAY,CAAC1B,EAAE,WAAW,GAAG,GAAK,CAACA,EAAE,cAAc,SAAS,OAAO,CAAC,EAE/E,IAAIgC,GAAU,CACpC,MAAMhB,EAAmC,CACrC,CAACS,GAAa,QAAQ,EAAGM,EACzB,CAACJ,GAAa,mBAAmB,EAAGM,EACpC,CAACL,GAAU,cAAc,EAAGM,EAC5B,CAACV,CAAO,EAAGgB,EACX,CAACd,CAAM,EAAGM,CAAA,EAGd,IAAIkB,EAAOlB,EACX,OAAIkB,EAAK,SAAS,GAAG,GAAKA,EAAK,cAAc,SAAS,MAAM,GAAKA,EAAK,YAAA,EAAc,SAAS,MAAM,KAAGA,EAAO,WACzGA,EAAK,SAAS,GAAG,GAAKA,EAAK,cAAc,SAAS,MAAM,GAAKA,EAAK,YAAA,EAAc,SAAS,MAAM,KAAGA,EAAO,SAEtG,CACH,KAAAA,EACA,MAAOnC,EAAaX,EAAIY,CAAQ,EAChC,MAAOkC,IAAS,SAAW,UAAY,SAAA,CAE/C,CAAC,EAAE,KAAK,CAACT,EAAG,IAAM,EAAE,MAAQA,EAAE,KAAK,EAG7BU,EAAQrB,EAAO,OAAO,CAACsB,EAAKC,IAASD,EAAMC,EAAK,MAAO,CAAC,EAC9D,OAAOvB,EAAO,IAAIuB,IAAS,CACvB,GAAGA,EACH,QAASF,EAAQ,GAAKE,EAAK,MAAQF,EAAQ,KAAK,QAAQ,CAAC,EAAI,GAAA,EAC/D,CACN,EAEaG,GAAsB,IAAM,OACvC,KAAM,CAAE,CAAA,EAAMC,EAAA,EACR,CAACC,EAAgBC,CAAiB,EAAIC,EAAAA,SAAgB,CAAA,CAAE,EACxD,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAgB,CAAA,CAAE,EAC1C,CAACG,EAAiBC,CAAkB,EAAIJ,EAAAA,SAAgB,CAAA,CAAE,EAC1D,CAACK,EAAYC,CAAa,EAAIN,EAAAA,SAAgB,CAAA,CAAE,EAEhD,CAACO,EAASC,CAAU,EAAIR,EAAAA,SAAS,EAAI,EACrC,CAACS,EAAeC,CAAgB,EAAIV,EAAAA,SAAS,EAAK,EAClD,CAACW,EAAUC,CAAW,EAAIZ,EAAAA,SAAwB,IAAI,EACtD,CAACa,EAAaC,CAAc,EAAId,EAAAA,SAAsB,IAAI,EAE1De,EAAe,MAAOC,EAAe,KAAU,CACnD,GAAI,CAKF,GAJAR,EAAW,EAAI,EACfI,EAAY,IAAI,EAGZ,CAACI,EAAc,CACf,MAAMC,EAAS,aAAa,QAAQ/F,CAAS,EAC7C,GAAI+F,EACA,GAAI,CACA,MAAMC,EAAS,KAAK,MAAMD,CAAM,EAEhC,GAAIC,EAAO,OAASA,EAAO,MAAQA,EAAO,YAAa,CACnD,QAAQ,IAAI,qCAAqC,EACjDnB,EAAkBmB,EAAO,KAAK,EAC9BhB,EAAWgB,EAAO,IAAI,EACtBd,EAAmBc,EAAO,WAAW,EACrCZ,EAAcY,EAAO,MAAM,EAC3BR,EAAiB,EAAI,EACrBI,EAAe,IAAI,KAAKI,EAAO,SAAS,CAAC,EACzCV,EAAW,EAAK,EAChB,MACJ,CACJ,MAAY,CACR,aAAa,WAAWtF,CAAS,CACrC,CAER,CAGA,MAAMiG,EAAW,MAAM,MAAMnG,EAAmB,EAChD,GAAI,CAACmG,EAAS,GAAI,MAAM,IAAI,MAAM,uBAAuBA,EAAS,MAAM,EAAE,EAE1E,MAAMC,EAAS,MAAMD,EAAS,YAAA,EAExBE,EADU,IAAI,YAAY,YAAY,EACvB,OAAOD,CAAM,EAE5BE,EAASnG,GAAYkG,CAAI,EAE/B,GAAIC,EAAQ,CACR,QAAQ,MAAM,wBAAwB,EAEtC,MAAMC,EAAQ1D,GAAayD,CAAM,EACjCvB,EAAkBwB,CAAK,EAEvB,MAAMC,EAAO3C,GAAuByC,CAAM,EAC1CpB,EAAWsB,CAAI,EAEf,MAAMC,EAAcvC,GAAmBoC,CAAM,EAC7ClB,EAAmBqB,CAAW,EAE9B,MAAMC,EAAUnC,GAAsB+B,CAAM,EAC5ChB,EAAcoB,CAAO,EAErB,QAAQ,SAAA,EAGR,MAAMC,EAAe,CACjB,UAAW,KAAK,IAAA,EAChB,MAAAJ,EACA,KAAAC,EACA,YAAAC,EACA,OAAQC,CAAA,EAEZ,aAAa,QAAQxG,EAAW,KAAK,UAAUyG,CAAY,CAAC,EAC5Db,EAAe,IAAI,IAAM,EAEzBJ,EAAiB,EAAI,CACzB,KACI,OAAM,IAAI,MAAM,mCAAmC,CAGzD,OAASkB,EAAY,CACnB,QAAQ,MAAM,mBAAoBA,CAAK,EACvChB,EAAYgB,EAAM,SAAW,8BAA8B,CAC7D,QAAA,CACEpB,EAAW,EAAK,CAClB,CACF,EAEAqB,EAAAA,UAAU,IAAM,CACdd,EAAa,EAAK,CACpB,EAAG,CAAA,CAAE,EAGL,MAAMe,EAAchC,EAAe,OAAS,EAAIA,EAAeA,EAAe,OAAS,CAAC,EAAE,YAAc,EAClGiC,EAAYjC,EAAe,OAAS,EAAIA,EAAeA,EAAe,OAAS,CAAC,EAAE,YAAc,EAChGkC,EAAaD,EAAY,IAAOD,EAAcC,GAAaA,EAAa,KAAK,QAAQ,CAAC,EAAI,MAC1FE,IAAcjF,EAAAqD,EAAW,KAAK6B,GAAKA,EAAE,OAAS,QAAQ,IAAxC,YAAAlF,EAA2C,UAAW,IAE1E,OACEmF,EAAAA,KAAC,MAAA,CAAI,UAAU,mMAEZ,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0KACZ,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,mGACZ,SAAA,CAAAC,EAAAA,IAACC,GAAA,CAAS,KAAM,GAAI,UAAU,kBAAiB,EAAE,IAAE,EAAE,aAAa,CAAA,EACpE,QACC,IAAA,CAAE,UAAU,kDACV,SAAA,EAAE,cAAc,CAAA,CACnB,CAAA,EACF,EAEC5B,GACC2B,EAAAA,IAAC,SAAA,CACG,QAAS,IAAMrB,EAAa,EAAI,EAChC,SAAUR,EACV,UAAU,6LACV,MAAO,EAAE,mBAAmB,EAE5B,eAAC+B,EAAA,CAAU,KAAM,GAAI,UAAW/B,EAAU,eAAiB,EAAA,CAAI,CAAA,CAAA,CACnE,EAEN,EAEA4B,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAGb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,wCACX,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,+GACZ,SAAA,CAAAA,EAAAA,KAAC,IAAA,CAAE,UAAU,wEACV,SAAA,CAAA,EAAE,4BAA4B,EAC/BC,EAAAA,IAACG,EAAA,CAAK,KAAM,GAAI,UAAU,2BAAA,CAA4B,CAAA,EACxD,EACAH,MAAC,IAAA,CAAE,UAAU,kEACV,WAAUA,EAAAA,IAACI,EAAA,CAAQ,UAAU,sBAAA,CAAsB,GAAMV,EAAc,KAAM,QAAQ,CAAC,EAAI,IAC7F,QAEC,MAAA,CAAI,UAAU,yFACb,SAAAK,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAAC,MAAC,IAAA,CAAE,UAAU,qBAAsB,SAAA,EAAE,yBAAyB,EAAE,QAC/D,IAAA,CAAE,UAAU,iBAAkB,SAAA,EAAE,wBAAwB,EAAE,EAC3DA,EAAAA,IAAC,MAAA,CAAI,UAAU,kGAAA,CAAmG,CAAA,CAAA,CACpH,CAAA,CACF,CAAA,EACH,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAW,yCAAyC,OAAOH,CAAU,GAAK,EAAI,qFAAuF,6BAA6B,GACpM,SAAA,CAAAG,EAAAA,KAAC,IAAA,CAAE,UAAW,2DAA2D,OAAOH,CAAU,GAAK,EAAI,mBAAqB,cAAc,GACnI,SAAA,CAAA,EAAE,sBAAsB,EACzBI,EAAAA,IAACG,EAAA,CAAK,KAAM,GAAI,UAAW,eAAe,OAAOP,CAAU,GAAK,EAAI,mBAAqB,cAAc,EAAA,CAAI,CAAA,EAC7G,EACAG,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAA,EAAAA,KAAC,IAAA,CAAE,UAAU,6DAA8D,SAAA,CAAAH,EAAW,GAAA,EAAC,EACtF,OAAOA,CAAU,GAAK,EAAII,EAAAA,IAACK,GAAW,KAAM,GAAI,UAAU,kBAAA,CAAkB,EAAKL,EAAAA,IAACK,EAAA,CAAW,KAAM,GAAI,UAAU,yBAAA,CAAyB,CAAA,EAC7I,QAEC,MAAA,CAAI,UAAU,yFACb,SAAAN,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAAC,MAAC,IAAA,CAAE,UAAU,qBAAsB,SAAA,EAAE,yBAAyB,EAAE,QAC/D,IAAA,CAAE,UAAU,iBAAkB,SAAA,EAAE,wBAAwB,EAAE,EAC3DA,EAAAA,IAAC,MAAA,CAAI,UAAU,kGAAA,CAAmG,CAAA,CAAA,CACpH,CAAA,CACF,CAAA,EACH,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,uHACZ,SAAA,CAAAA,EAAAA,KAAC,IAAA,CAAE,UAAU,0EACV,SAAA,CAAA,EAAE,wBAAwB,EAC3BC,EAAAA,IAACG,EAAA,CAAK,KAAM,GAAI,UAAU,6BAAA,CAA8B,CAAA,EAC1D,QACC,IAAA,CAAE,UAAU,0EAA2E,SAAA,EAAE,eAAe,EAAE,QAE1G,MAAA,CAAI,UAAU,yFACb,SAAAJ,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAAC,MAAC,IAAA,CAAE,UAAU,qBAAsB,SAAA,EAAE,0BAA0B,EAAE,QAChE,IAAA,CAAE,UAAU,iBAAkB,SAAA,EAAE,yBAAyB,EAAE,EAC5DA,EAAAA,IAAC,MAAA,CAAI,UAAU,kGAAA,CAAmG,CAAA,CAAA,CACpH,CAAA,CACF,CAAA,EACH,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,uHACZ,SAAA,CAAAA,EAAAA,KAAC,IAAA,CAAE,UAAU,0EACV,SAAA,CAAA,EAAE,mBAAmB,EACtBC,EAAAA,IAACG,EAAA,CAAK,KAAM,GAAI,UAAU,6BAAA,CAA8B,CAAA,EAC1D,EACAJ,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACZ,SAAA,CAAAA,EAAAA,KAAC,IAAA,CAAE,UAAU,6DAA8D,SAAA,CAAAF,EAAY,GAAA,EAAC,EACxFG,EAAAA,IAAC,OAAA,CAAK,UAAU,8BAA8B,SAAA,GAAA,CAAC,CAAA,EAClD,QAEC,MAAA,CAAI,UAAU,yFACb,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAAC,MAAC,IAAA,CAAE,UAAU,qBAAsB,SAAA,EAAE,0BAA0B,EAAE,QAChE,IAAA,CAAE,UAAU,iBAAkB,SAAA,EAAE,yBAAyB,EAAE,EAC5DA,EAAAA,IAAC,MAAA,CAAI,UAAU,kGAAA,CAAmG,CAAA,CAAA,CACpH,CAAA,CACF,CAAA,CAAA,CACH,CAAA,EACJ,EAGAD,EAAAA,KAAC,MAAA,CAAI,UAAU,wCAGX,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,8HACZ,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,oFACZ,SAAA,CAAAC,EAAAA,IAACK,EAAA,CAAW,KAAM,GAAI,UAAU,gBAAe,EAAE,IAAE,EAAE,uBAAuB,CAAA,EAC9E,EACAL,EAAAA,IAAC,MAAA,CAAI,UAAU,mBACb,SAAAA,EAAAA,IAACM,GAAoB,MAAM,OAAO,OAAO,OACvC,SAAAP,EAAAA,KAACQ,EAAA,CAAU,KAAM7C,EAAgB,OAAQ,CAAE,IAAK,GAAI,MAAO,GAAI,KAAM,EAAG,OAAQ,CAAA,EAC9E,SAAA,CAAAsC,EAAAA,IAAC,OAAA,CACC,SAAAD,EAAAA,KAAC,iBAAA,CAAe,GAAG,aAAa,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IACtD,SAAA,CAAAC,MAAC,QAAK,OAAO,KAAK,UAAU,UAAU,YAAa,GAAI,QACtD,OAAA,CAAK,OAAO,MAAM,UAAU,UAAU,YAAa,CAAA,CAAE,CAAA,CAAA,CACxD,CAAA,CACF,EACAA,EAAAA,IAACQ,GAAc,gBAAgB,MAAM,SAAU,GAAO,OAAO,UAAU,cAAe,EAAA,CAAK,EAC3FR,MAACS,GAAM,QAAQ,OAAO,SAAU,GAAO,SAAU,GAAO,KAAM,CAAC,SAAU,GAAI,KAAM,UAAW,WAAY,KAAM,GAAI,GAAI,WAAY,GAAI,EACxIT,EAAAA,IAACU,EAAA,CAAM,SAAU,GAAO,SAAU,GAAO,KAAM,CAAC,SAAU,GAAI,KAAM,UAAW,WAAY,GAAA,EAAM,OAAQ,CAAC,iBAAkB,MAAM,EAAG,MAAO,GAAI,cAAgBpE,GAAQ,IAAIA,EAAI,KAAM,QAAQ,CAAC,CAAC,IAAK,EACrM0D,EAAAA,IAACW,EAAA,CACE,aAAc,CAAC,aAAc,OAAQ,OAAQ,OAAQ,UAAW,qCAAA,EAChE,UAAYC,GAAe,CAAC,OAAOA,CAAK,EAAE,eAAe,OAAO,EAAG,EAAE,eAAe,CAAC,CAAA,CAAA,EAExFZ,EAAAA,IAACa,EAAA,CAAK,KAAK,WAAW,QAAQ,cAAc,OAAO,UAAU,YAAa,EAAG,YAAa,EAAG,KAAK,mBAAmB,kBAAmB,IAAA,CAAM,CAAA,CAAA,CAChJ,EACF,CAAA,CACF,CAAA,EACH,EAGAd,EAAAA,KAAC,MAAA,CAAI,UAAU,qGACZ,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,oFACZ,SAAA,CAAAC,EAAAA,IAACc,EAAA,CAAU,KAAM,GAAI,UAAU,mBAAkB,EAAE,IAAE,EAAE,uBAAuB,CAAA,EAChF,EACAd,EAAAA,IAAC,MAAA,CAAI,UAAU,mBACb,SAAAA,EAAAA,IAACM,EAAA,CAAoB,MAAM,OAAO,OAAO,OACvC,SAAAP,EAAAA,KAACgB,GAAA,CAAS,KAAMlD,EAAS,OAAO,WAAW,OAAQ,CAAE,IAAK,EAAG,MAAO,GAAI,KAAM,GAAI,OAAQ,CAAA,EAAK,QAAS,GACtG,SAAA,CAAAmC,EAAAA,IAACQ,EAAA,CAAc,gBAAgB,MAAM,WAAY,GAAM,SAAU,GAAO,OAAO,UAAU,cAAe,EAAA,CAAK,EAC7GR,EAAAA,IAACS,EAAA,CAAM,KAAK,SAAS,KAAI,GAAC,EAC1BT,MAACU,GAAM,QAAQ,OAAO,KAAK,WAAW,MAAO,GAAI,KAAM,CAAC,SAAU,GAAI,KAAM,UAAW,WAAY,KAAM,SAAU,GAAO,SAAU,GAAO,EAC3IV,EAAAA,IAACW,EAAA,CAAQ,OAAQ,CAAC,KAAM,aAAA,EAAgB,aAAc,CAAC,aAAc,MAAA,CAAM,CAAG,EAC9EX,EAAAA,IAACgB,GAAA,CAAI,QAAQ,QAAQ,OAAQ,CAAC,EAAG,EAAG,EAAG,CAAC,EAAG,KAAK,UAAU,KAAK,aAC3D,SAAAnD,EAAQ,IAAI,CAACoD,EAAO9F,IACjB6E,EAAAA,IAACkB,GAAA,CAA2B,KAAM/F,EAAQ,IAAM,EAAI,UAAY,WAArD,QAAQA,CAAK,EAAmD,CAC9E,CAAA,CACJ,CAAA,CAAA,CACF,EACF,CAAA,CACF,CAAA,EACH,EAGA4E,EAAAA,KAAC,MAAA,CAAI,UAAU,qGACZ,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,oFACZ,SAAA,CAAAC,EAAAA,IAACmB,EAAA,CAAe,KAAM,GAAI,UAAU,kBAAiB,EAAE,IAAE,EAAE,mBAAmB,CAAA,EAChF,EACAnB,EAAAA,IAAC,MAAA,CAAI,UAAU,mBACZ,SAAAjC,EAAgB,OAAS,EACvBiC,EAAAA,IAACM,EAAA,CAAoB,MAAM,OAAO,OAAO,OACrC,SAAAP,EAAAA,KAACqB,GAAA,CAAU,KAAMrD,EAAiB,OAAQ,CAAE,IAAK,GAAI,MAAO,GAAI,KAAM,EAAG,OAAQ,CAAA,EAC7E,SAAA,CAAAiC,MAACQ,GAAc,gBAAgB,MAAM,SAAU,GAAO,cAAe,GAAK,QACzEC,EAAA,CAAM,QAAQ,OAAO,SAAU,GAAO,SAAU,GAAO,KAAM,CAAC,SAAU,GAAI,KAAM,SAAA,EAAY,GAAI,GAAI,WAAY,GAAI,EACvHT,EAAAA,IAACU,EAAA,CAAM,SAAU,GAAO,SAAU,GAAO,KAAM,CAAC,SAAU,GAAI,KAAM,SAAA,EAAY,MAAO,GAAI,cAAgBpE,GAAQ,IAAIA,EAAI,KAAM,QAAQ,CAAC,CAAC,GAAA,CAAK,QAC/IqE,EAAA,CAAQ,aAAc,CAAC,aAAc,QAAS,EAC/CX,EAAAA,IAACqB,GAAA,CAAO,SAAS,SAAS,aAAc,CAAC,SAAU,OAAQ,WAAY,MAAA,CAAM,CAAE,QAC9EC,EAAA,CAAK,KAAK,WAAW,QAAQ,SAAS,OAAO,UAAU,YAAa,EAAG,IAAK,GAAO,UAAW,CAAC,EAAG,GAAI,QACtGA,EAAA,CAAK,KAAK,WAAW,QAAQ,QAAQ,OAAO,UAAU,YAAa,EAAG,IAAK,GAAO,UAAW,CAAC,EAAG,EAAC,CAAG,CAAA,CAAA,CAC1G,CAAA,CACJ,EAEAtB,EAAAA,IAAC,MAAA,CAAI,UAAU,yEACV,SAAA7B,QAAWiC,EAAA,CAAQ,UAAU,eAAe,EAAKJ,EAAAA,IAAC,QAAK,UAAU,iBAAkB,WAAE,wBAAwB,CAAA,CAAE,EACpH,CAAA,CAEL,CAAA,CAAA,CACH,CAAA,CAAA,CAEJ,CAAA,EAEF,QAGC,MAAA,CAAI,UAAU,OACb,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,8JACX,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACX,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,sFACX,eAACG,EAAA,CAAK,KAAM,GAAI,CAAA,CACpB,EACAJ,EAAAA,KAAC,MAAA,CAAI,UAAU,sFACV,SAAA,CAAA,EAAE,qBAAqB,EACvB1B,EACG0B,EAAAA,KAAC,OAAA,CAAK,UAAU,wDACX,SAAA,CAAA,EAAE,kBAAkB,EAAE,KAAGtB,GAAA,YAAAA,EAAa,oBAAmB,EAC9D,EAEAF,GAAYyB,MAAC,OAAA,CAAK,UAAU,oBAAqB,SAAAzB,CAAA,CAAS,CAAA,CAAA,CAElE,CAAA,EACJ,EACAwB,EAAAA,KAAC,IAAA,CACD,KAAMlH,GACN,OAAO,SACP,IAAI,aACJ,UAAU,uPAET,SAAA,CAAA,EAAE,iBAAiB,EAAE,IAACmH,EAAAA,IAACuB,GAAA,CAAa,KAAM,EAAA,CAAI,CAAA,CAAA,CAAA,CAC/C,CAAA,CACJ,CAAA,CACF,CAAA,EAEF,CAEJ"}