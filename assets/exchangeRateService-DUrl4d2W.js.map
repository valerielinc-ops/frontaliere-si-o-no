{"version":3,"file":"exchangeRateService-DUrl4d2W.js","sources":["../../services/exchangeRateService.ts"],"sourcesContent":["/**\n * Shared Exchange Rate Service\n * Fetches CHF/EUR rate from frankfurter.app API (same as CurrencyExchange component)\n * Used across ShoppingCalculator, CostOfLiving, and other components\n */\n\nimport { useState, useEffect } from 'react';\n\nconst API_URL = 'https://api.frankfurter.app/latest?from=CHF&to=EUR';\nconst CACHE_KEY = 'exchange_rate_cache';\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\n\ninterface CacheEntry {\n  rate: number;\n  timestamp: number;\n}\n\n/**\n * Get cached rate from localStorage if still fresh\n */\nfunction getCachedRate(): number | null {\n  try {\n    const cached = localStorage.getItem(CACHE_KEY);\n    if (!cached) return null;\n    const entry: CacheEntry = JSON.parse(cached);\n    if (Date.now() - entry.timestamp < CACHE_DURATION) {\n      return entry.rate;\n    }\n  } catch {\n    // ignore\n  }\n  return null;\n}\n\n/**\n * Save rate to localStorage cache\n */\nfunction setCachedRate(rate: number): void {\n  try {\n    const entry: CacheEntry = { rate, timestamp: Date.now() };\n    localStorage.setItem(CACHE_KEY, JSON.stringify(entry));\n  } catch {\n    // ignore\n  }\n}\n\n/**\n * Fetch the latest CHF to EUR exchange rate from frankfurter.app\n */\nexport async function fetchExchangeRate(): Promise<number> {\n  // Check cache first\n  const cached = getCachedRate();\n  if (cached) return cached;\n\n  try {\n    const res = await fetch(API_URL);\n    const data = await res.json();\n    if (data?.rates?.EUR) {\n      const rate = data.rates.EUR as number;\n      setCachedRate(rate);\n      return rate;\n    }\n  } catch (e) {\n    console.error('Failed to fetch exchange rate:', e);\n  }\n\n  // Fallback: try cache even if expired\n  try {\n    const cached = localStorage.getItem(CACHE_KEY);\n    if (cached) return JSON.parse(cached).rate;\n  } catch {\n    // ignore\n  }\n\n  // Final fallback\n  return 0.94;\n}\n\n/**\n * React hook to get the live CHF/EUR exchange rate\n * Returns [rate, loading, lastUpdate]\n */\nexport function useExchangeRate(): {\n  rate: number;\n  loading: boolean;\n  lastUpdate: Date | null;\n} {\n  const [rate, setRate] = useState<number>(() => getCachedRate() || 0.94);\n  const [loading, setLoading] = useState(false);\n  const [lastUpdate, setLastUpdate] = useState<Date | null>(null);\n\n  useEffect(() => {\n    let mounted = true;\n\n    const load = async () => {\n      setLoading(true);\n      try {\n        const r = await fetchExchangeRate();\n        if (mounted) {\n          setRate(r);\n          setLastUpdate(new Date());\n        }\n      } finally {\n        if (mounted) setLoading(false);\n      }\n    };\n\n    load();\n\n    // Refresh every 5 minutes\n    const interval = setInterval(load, 5 * 60 * 1000);\n    return () => {\n      mounted = false;\n      clearInterval(interval);\n    };\n  }, []);\n\n  return { rate, loading, lastUpdate };\n}\n"],"names":["API_URL","CACHE_KEY","CACHE_DURATION","getCachedRate","cached","entry","setCachedRate","rate","fetchExchangeRate","data","_a","e","useExchangeRate","setRate","useState","loading","setLoading","lastUpdate","setLastUpdate","useEffect","mounted","load","r","interval"],"mappings":"gDAQA,MAAMA,EAAU,qDACVC,EAAY,sBACZC,EAAiB,IAAS,IAUhC,SAASC,GAA+B,CACtC,GAAI,CACF,MAAMC,EAAS,aAAa,QAAQH,CAAS,EAC7C,GAAI,CAACG,EAAQ,OAAO,KACpB,MAAMC,EAAoB,KAAK,MAAMD,CAAM,EAC3C,GAAI,KAAK,IAAA,EAAQC,EAAM,UAAYH,EACjC,OAAOG,EAAM,IAEjB,MAAQ,CAER,CACA,OAAO,IACT,CAKA,SAASC,EAAcC,EAAoB,CACzC,GAAI,CACF,MAAMF,EAAoB,CAAE,KAAAE,EAAM,UAAW,KAAK,KAAI,EACtD,aAAa,QAAQN,EAAW,KAAK,UAAUI,CAAK,CAAC,CACvD,MAAQ,CAER,CACF,CAKA,eAAsBG,GAAqC,OAEzD,MAAMJ,EAASD,EAAA,EACf,GAAIC,EAAQ,OAAOA,EAEnB,GAAI,CAEF,MAAMK,EAAO,MADD,MAAM,MAAMT,CAAO,GACR,KAAA,EACvB,IAAIU,EAAAD,GAAA,YAAAA,EAAM,QAAN,MAAAC,EAAa,IAAK,CACpB,MAAMH,EAAOE,EAAK,MAAM,IACxB,OAAAH,EAAcC,CAAI,EACXA,CACT,CACF,OAASI,EAAG,CACV,QAAQ,MAAM,iCAAkCA,CAAC,CACnD,CAGA,GAAI,CACF,MAAMP,EAAS,aAAa,QAAQH,CAAS,EAC7C,GAAIG,EAAQ,OAAO,KAAK,MAAMA,CAAM,EAAE,IACxC,MAAQ,CAER,CAGA,MAAO,IACT,CAMO,SAASQ,GAId,CACA,KAAM,CAACL,EAAMM,CAAO,EAAIC,EAAAA,SAAiB,IAAMX,EAAA,GAAmB,GAAI,EAChE,CAACY,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAK,EACtC,CAACG,EAAYC,CAAa,EAAIJ,EAAAA,SAAsB,IAAI,EAE9DK,OAAAA,EAAAA,UAAU,IAAM,CACd,IAAIC,EAAU,GAEd,MAAMC,EAAO,SAAY,CACvBL,EAAW,EAAI,EACf,GAAI,CACF,MAAMM,EAAI,MAAMd,EAAA,EACZY,IACFP,EAAQS,CAAC,EACTJ,EAAc,IAAI,IAAM,EAE5B,QAAA,CACME,KAAoB,EAAK,CAC/B,CACF,EAEAC,EAAA,EAGA,MAAME,EAAW,YAAYF,EAAM,IAAS,GAAI,EAChD,MAAO,IAAM,CACXD,EAAU,GACV,cAAcG,CAAQ,CACxB,CACF,EAAG,CAAA,CAAE,EAEE,CAAE,KAAAhB,EAAM,QAAAQ,EAAS,WAAAE,CAAA,CAC1B"}