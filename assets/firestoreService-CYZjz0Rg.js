import{r}from"./vendor-charts-B1jiPnU9.js";import{g as k,o as S,a as D,s as O,G as P,b as x,c as F,d as A,e as i,w as I,f as y,l as B,q,h as C,i as h,u as d,j as l,k as R,m as G,n as L,p as f}from"./vendor-firebase-BMmHVpWp.js";import{app as _}from"./firebase-HdRpYmdN.js";import{A as m}from"./index-DIpd8jQu.js";let w=null;function U(){return w||(w=D(_)),w}const b=new P;b.setCustomParameters({prompt:"select_account"});async function Q(){var t;try{const e=U();try{const a=await O(e,b);return m.trackUIInteraction("auth","google","login","success"),a.user}catch(a){if((a==null?void 0:a.code)==="auth/popup-blocked"||(a==null?void 0:a.code)==="auth/popup-closed-by-user"||(t=a==null?void 0:a.message)!=null&&t.includes("Cross-Origin-Opener-Policy"))return await x(e,b),null;throw a}}catch(e){return(e==null?void 0:e.code)!=="auth/popup-closed-by-user"&&(console.warn("Google sign-in error:",e),m.trackUIInteraction("auth","google","login","error")),null}}async function T(){try{const t=U();await F(t),m.trackUIInteraction("auth","google","logout","success")}catch(t){console.warn("Sign-out error:",t)}}function M(){const[t,e]=r.useState(null),[a,s]=r.useState(!0);r.useEffect(()=>{const g=U();return k(g).then(u=>{u!=null&&u.user&&m.trackUIInteraction("auth","google","login","success-redirect")}).catch(()=>{}),S(g,u=>{e(u),s(!1)})},[]);const n=r.useCallback(async()=>Q(),[]),o=r.useCallback(async()=>T(),[]);return{user:t,loading:a,signIn:n,logout:o}}function $(t){var e;return t?t.displayName||((e=t.email)==null?void 0:e.split("@")[0])||"Utente":""}function H(t){return(t==null?void 0:t.photoURL)||null}let v=null;function c(){return v||(v=G(_)),v}async function J(t,e){const a=c();return(await A(i(a,"simulations"),{userId:t,date:e.date,label:e.label,inputs:e.inputs,result:e.result,createdAt:f()})).id}async function K(t){const e=c(),a=q(i(e,"simulations"),I("userId","==",t),y("createdAt","desc"),B(50));return(await C(a)).docs.map(n=>({id:n.id,...n.data()}))}async function V(t){const e=c();await L(h(e,"simulations",t))}const X=["fiscalita","permessi","assicurazioni","pensione","trasporti","residenza","lavoro","famiglia","generale"];async function Y(t){const e=c();return(await A(i(e,"forum_questions"),{...t,upvotes:0,upvotedBy:[],answerCount:0,createdAt:f(),updatedAt:f()})).id}async function Z(t){const e=c(),a=[];t!=null&&t.category&&a.push(I("category","==",t.category)),(t==null?void 0:t.sortBy)==="popular"?a.push(y("upvotes","desc")):a.push(y("createdAt","desc")),a.push(B((t==null?void 0:t.maxResults)||30));const s=q(i(e,"forum_questions"),...a);return(await C(s)).docs.map(o=>({id:o.id,...o.data()}))}async function E(t,e){const a=c(),s=h(a,"forum_questions",t),n=await R(s);if(!n.exists())return;const o=n.data();(o.upvotedBy||[]).includes(e)?await d(s,{upvotes:l(-1),upvotedBy:(o.upvotedBy||[]).filter(p=>p!==e)}):await d(s,{upvotes:l(1),upvotedBy:[...o.upvotedBy||[],e]})}async function tt(t){const e=c(),a=await A(i(e,"forum_answers"),{...t,upvotes:0,upvotedBy:[],accepted:!1,createdAt:f()}),s=h(e,"forum_questions",t.questionId);return await d(s,{answerCount:l(1),updatedAt:f()}),a.id}async function et(t){const e=c(),a=q(i(e,"forum_answers"),I("questionId","==",t),y("createdAt","asc"),B(100));return(await C(a)).docs.map(n=>({id:n.id,...n.data()}))}async function at(t,e){const a=c(),s=h(a,"forum_answers",t),n=await R(s);if(!n.exists())return;const o=n.data();(o.upvotedBy||[]).includes(e)?await d(s,{upvotes:l(-1),upvotedBy:(o.upvotedBy||[]).filter(p=>p!==e)}):await d(s,{upvotes:l(1),upvotedBy:[...o.upvotedBy||[],e]})}export{X as F,$ as a,Z as b,et as c,V as d,Y as e,tt as f,H as g,E as h,at as i,K as l,J as s,M as u};
//# sourceMappingURL=firestoreService-CYZjz0Rg.js.map
