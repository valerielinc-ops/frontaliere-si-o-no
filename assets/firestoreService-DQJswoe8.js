import{r}from"./vendor-charts-aQyCzDkf.js";import{e as k,o as S,h as D,j as x,G as O,k as P,m as F,n as A,p as u,w as I,q as p,r as B,t as q,u as C,v as h,x as d,y as l,z as R,A as G,B as z,C as f}from"./vendor-firebase-BEgIyS5z.js";import{A as m,af as _}from"./index-CU426Fnh.js";let w=null;function U(){return w||(w=D(_)),w}const b=new O;b.setCustomParameters({prompt:"select_account"});async function L(){var t;try{const e=U();try{const a=await x(e,b);return m.trackUIInteraction("auth","google","login","success"),a.user}catch(a){if((a==null?void 0:a.code)==="auth/popup-blocked"||(a==null?void 0:a.code)==="auth/popup-closed-by-user"||(t=a==null?void 0:a.message)!=null&&t.includes("Cross-Origin-Opener-Policy"))return await P(e,b),null;throw a}}catch(e){return(e==null?void 0:e.code)!=="auth/popup-closed-by-user"&&(console.warn("Google sign-in error:",e),m.trackUIInteraction("auth","google","login","error")),null}}async function Q(){try{const t=U();await F(t),m.trackUIInteraction("auth","google","logout","success")}catch(t){console.warn("Sign-out error:",t)}}function j(){const[t,e]=r.useState(null),[a,s]=r.useState(!0);r.useEffect(()=>{const g=U();return k(g).then(i=>{i!=null&&i.user&&m.trackUIInteraction("auth","google","login","success-redirect")}).catch(()=>{}),S(g,i=>{e(i),s(!1)})},[]);const n=r.useCallback(async()=>L(),[]),o=r.useCallback(async()=>Q(),[]);return{user:t,loading:a,signIn:n,logout:o}}function M(t){var e;return t?t.displayName||((e=t.email)==null?void 0:e.split("@")[0])||"Utente":""}function $(t){return(t==null?void 0:t.photoURL)||null}let v=null;function c(){return v||(v=G(_)),v}async function H(t,e){const a=c();return(await A(u(a,"simulations"),{userId:t,date:e.date,label:e.label,inputs:e.inputs,result:e.result,createdAt:f()})).id}async function J(t){const e=c(),a=q(u(e,"simulations"),I("userId","==",t),p("createdAt","desc"),B(50));return(await C(a)).docs.map(n=>({id:n.id,...n.data()}))}async function K(t){const e=c();await z(h(e,"simulations",t))}const V=["fiscalita","permessi","assicurazioni","pensione","trasporti","residenza","lavoro","famiglia","generale"];async function X(t){const e=c();return(await A(u(e,"forum_questions"),{...t,upvotes:0,upvotedBy:[],answerCount:0,createdAt:f(),updatedAt:f()})).id}async function Y(t){const e=c(),a=[];t!=null&&t.category&&a.push(I("category","==",t.category)),(t==null?void 0:t.sortBy)==="popular"?a.push(p("upvotes","desc")):a.push(p("createdAt","desc")),a.push(B((t==null?void 0:t.maxResults)||30));const s=q(u(e,"forum_questions"),...a);return(await C(s)).docs.map(o=>({id:o.id,...o.data()}))}async function Z(t,e){const a=c(),s=h(a,"forum_questions",t),n=await R(s);if(!n.exists())return;const o=n.data();(o.upvotedBy||[]).includes(e)?await d(s,{upvotes:l(-1),upvotedBy:(o.upvotedBy||[]).filter(y=>y!==e)}):await d(s,{upvotes:l(1),upvotedBy:[...o.upvotedBy||[],e]})}async function E(t){const e=c(),a=await A(u(e,"forum_answers"),{...t,upvotes:0,upvotedBy:[],accepted:!1,createdAt:f()}),s=h(e,"forum_questions",t.questionId);return await d(s,{answerCount:l(1),updatedAt:f()}),a.id}async function tt(t){const e=c(),a=q(u(e,"forum_answers"),I("questionId","==",t),p("createdAt","asc"),B(100));return(await C(a)).docs.map(n=>({id:n.id,...n.data()}))}async function et(t,e){const a=c(),s=h(a,"forum_answers",t),n=await R(s);if(!n.exists())return;const o=n.data();(o.upvotedBy||[]).includes(e)?await d(s,{upvotes:l(-1),upvotedBy:(o.upvotedBy||[]).filter(y=>y!==e)}):await d(s,{upvotes:l(1),upvotedBy:[...o.upvotedBy||[],e]})}export{V as F,M as a,Y as b,tt as c,K as d,X as e,E as f,$ as g,Z as h,et as i,J as l,H as s,j as u};
//# sourceMappingURL=firestoreService-DQJswoe8.js.map
