import{u as E,A as u,j as e,z as I,r as P,R as K,f as _,T as N,a as U}from"./index-BZ7LQtDa.js";import{r as i}from"./vendor-charts-aQyCzDkf.js";import{M as B,T as G,a as O,P as H,L as F}from"./vendor-maps-DqRXYzFN.js";import{t as v}from"./trafficService-pjRz1yyL.js";import{b as V}from"./borderCrossings-CQBmICU_.js";import{L as Y,N as k}from"./navigation-CDQJNzxh.js";import{C as Z}from"./clock-mur3dLIV.js";import"./vendor-pdf-og5EeDf1.js";import"./vendor-firebase-BEgIyS5z.js";import"./recaptchaService-BPXl6w1g.js";const T=V.map(t=>({...t,coordinates:[t.lat,t.lng]})),j={green:"#22c55e",yellow:"#eab308",red:"#ef4444"},C={green:"traffic.status.green",yellow:"traffic.status.yellow",red:"traffic.status.red"},q=(t,n)=>{const o=j[t],r=t==="red"?42:t==="yellow"?36:30;return F.divIcon({className:"traffic-marker",html:`
      <div style="
        width: ${r}px; height: ${r}px;
        background: ${o};
        border: 3px solid white;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3), 0 0 0 2px ${o}40;
        display: flex; align-items: center; justify-content: center;
        color: white; font-weight: 800; font-size: ${r>36?14:12}px;
        font-family: system-ui;
        ${t==="red"?"animation: pulse 2s infinite;":""}
      ">${n}</div>
    `,iconSize:[r,r],iconAnchor:[r/2,r/2],popupAnchor:[0,-r/2-4]})},ne=()=>{const{t}=E(),[n,o]=i.useState([]),[r,y]=i.useState(!1),[M,S]=i.useState(new Date),[c,z]=i.useState(!1),[x,w]=i.useState("map"),[$,f]=i.useState(null),p=async()=>{y(!0);try{const s=await v.getTrafficData();o(s),S(new Date),z(v.hasApiKey()),u.trackTrafficAlerts("refresh")}catch(s){console.error("Error loading traffic data:",s)}finally{y(!1)}};i.useEffect(()=>{p(),u.trackTrafficAlerts("view");const s=setInterval(()=>p(),3600*1e3);return()=>clearInterval(s)},[]);const h=i.useMemo(()=>[...n].sort((s,a)=>s.waitTimeMinutes-a.waitTimeMinutes),[n]),A=i.useMemo(()=>T.filter(s=>s.trafficLevel!=="closed").map(s=>{const a=n.find(l=>l.crossingName===s.name);return{crossing:s,traffic:a||{crossingName:s.name,waitTimeMinutes:0,status:"green",direction:"N/A",lastUpdate:new Date,source:"mock"}}}).sort((s,a)=>s.traffic.waitTimeMinutes-a.traffic.waitTimeMinutes),[n]),g=h[0],b=h[h.length-1],L=[45.92,8.97],W=s=>n.find(a=>a.crossingName===s);return e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { transform: scale(1); opacity: 1; }
          50% { transform: scale(1.15); opacity: 0.85; }
        }
        .traffic-marker { background: none !important; border: none !important; }
      `}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-600 to-red-700 rounded-2xl p-8 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(I,{size:32}),e.jsx("h2",{className:"text-3xl font-extrabold",children:t("traffic.title")})]}),e.jsx("p",{className:"text-orange-100 text-lg",children:t("traffic.subtitle")})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-700 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>w("map"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${x==="map"?"bg-indigo-600 text-white shadow-sm":"text-slate-600 dark:text-slate-300 hover:text-slate-800 dark:hover:text-white"}`,children:[e.jsx(P,{size:14})," ",t("traffic.viewMap")]}),e.jsxs("button",{onClick:()=>w("list"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${x==="list"?"bg-indigo-600 text-white shadow-sm":"text-slate-600 dark:text-slate-300 hover:text-slate-800 dark:hover:text-white"}`,children:[e.jsx(Y,{size:14})," ",t("traffic.viewList")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{size:16,className:"text-slate-500"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-500",children:M.toLocaleTimeString("it-IT")})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-3 text-xs text-slate-500 dark:text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-emerald-500 inline-block"})," ",t("traffic.status.green")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-yellow-500 inline-block"})," ",t("traffic.status.yellow")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500 inline-block"})," ",t("traffic.status.red")]})]}),e.jsxs("button",{onClick:p,disabled:r,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition-colors",children:[e.jsx(K,{size:16,className:r?"animate-spin":""}),t("traffic.refresh")]})]})]})}),e.jsx("div",{className:`border-l-4 p-3 rounded-lg ${c?"bg-emerald-50 dark:bg-emerald-950/30 border-emerald-500":"bg-blue-50 dark:bg-blue-950/30 border-blue-500"}`,children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c?e.jsx(_,{className:"text-emerald-600 flex-shrink-0",size:16}):e.jsx(N,{className:"text-blue-600 flex-shrink-0",size:16}),e.jsx("span",{className:c?"text-emerald-800 dark:text-emerald-200":"text-blue-800 dark:text-blue-200",children:t(c?"traffic.dataReal":"traffic.dataSimulated")})]})}),g&&b&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-green-50 dark:from-emerald-950/30 dark:to-green-950/30 rounded-xl border border-emerald-200 dark:border-emerald-800 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(U,{size:18,className:"text-emerald-600"}),e.jsx("span",{className:"text-xs font-bold text-emerald-700 dark:text-emerald-400",children:t("traffic.fastest")})]}),e.jsx("p",{className:"text-lg font-extrabold text-slate-800 dark:text-slate-100",children:g.crossingName}),e.jsxs("p",{className:"text-2xl font-extrabold text-emerald-600",children:[g.waitTimeMinutes," min"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-950/30 dark:to-orange-950/30 rounded-xl border border-red-200 dark:border-red-800 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(N,{size:18,className:"text-red-600"}),e.jsx("span",{className:"text-xs font-bold text-red-700 dark:text-red-400",children:t("traffic.slowest")})]}),e.jsx("p",{className:"text-lg font-extrabold text-slate-800 dark:text-slate-100",children:b.crossingName}),e.jsxs("p",{className:"text-2xl font-extrabold text-red-600",children:[b.waitTimeMinutes," min"]})]})]}),x==="map"&&e.jsxs("div",{className:"rounded-2xl overflow-hidden border-2 border-slate-200 dark:border-slate-700 shadow-lg",children:[e.jsxs(B,{center:L,zoom:11,style:{height:"500px",width:"100%"},scrollWheelZoom:!0,children:[e.jsx(G,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),T.map(s=>{const a=W(s.name),l=(a==null?void 0:a.status)||"green",d=(a==null?void 0:a.waitTimeMinutes)||0;return e.jsx(O,{position:s.coordinates,icon:q(l,d),eventHandlers:{click:()=>{f(s.name),u.trackTrafficAlerts("filter",s.name,d)}},children:e.jsx(H,{maxWidth:280,children:e.jsxs("div",{className:"p-1",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",flexShrink:0,background:j[l]}}),e.jsx("h3",{style:{fontWeight:800,fontSize:"16px",margin:0,color:"#1e293b"},children:s.name})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",fontSize:"14px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:t("traffic.wait")}),e.jsxs("span",{style:{fontWeight:700,color:j[l]},children:[d," min â€” ",t(C[l])]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:t("traffic.type")}),e.jsx("span",{style:{fontWeight:700,textTransform:"capitalize"},children:s.type})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:t("traffic.zone")}),e.jsxs("span",{style:{fontWeight:700},children:[s.canton," â€” ",s.province]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:t("traffic.hours")}),e.jsx("span",{style:{fontWeight:700},children:s.open24h?"24/7":t("traffic.limited")})]}),s.customsPresent&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:t("traffic.customs")}),e.jsx("span",{style:{fontWeight:700,color:"#2563eb"},children:t("traffic.customsPresent")})]}),(a==null?void 0:a.direction)&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:t("traffic.direction")}),e.jsx("span",{style:{fontWeight:700},children:a.direction})]}),(a==null?void 0:a.source)&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:t("traffic.source")}),e.jsx("span",{style:{fontWeight:700},children:a.source==="google-maps"?"ðŸ“ Google Maps":`ðŸŽ² ${t("traffic.simulated")}`})]})]}),e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${s.coordinates[0]},${s.coordinates[1]}&travelmode=driving`,target:"_blank",rel:"noopener noreferrer",style:{marginTop:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",width:"100%",padding:"8px",backgroundColor:"#4f46e5",color:"white",borderRadius:"8px",fontSize:"13px",fontWeight:700,textDecoration:"none"},children:t("traffic.navigateHere")})]})})},s.name)})]}),e.jsxs("div",{className:"sm:hidden flex items-center justify-center gap-4 py-3 bg-white dark:bg-slate-800 text-xs text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-emerald-500 inline-block"})," ",t("traffic.status.green")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-yellow-500 inline-block"})," ",t("traffic.status.yellow")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500 inline-block"})," ",t("traffic.status.red")]})]})]}),x==="list"&&e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map(({crossing:s,traffic:a})=>{const l=$===s.name,d=a.status==="green"?"bg-emerald-500":a.status==="yellow"?"bg-yellow-500":"bg-red-500",D=a.status==="green"?"border-emerald-400":a.status==="yellow"?"border-yellow-400":"border-red-400",R=a.status==="green"?"text-emerald-600":a.status==="yellow"?"text-yellow-600":"text-red-600";return e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>f(l?null:s.name),onKeyDown:m=>{(m.key==="Enter"||m.key===" ")&&f(l?null:s.name)},className:`text-left bg-white dark:bg-slate-800 rounded-xl border-2 p-4 hover:shadow-md transition-all cursor-pointer ${l?`${D} ring-2 ring-offset-1`:"border-slate-200 dark:border-slate-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`w-10 h-10 ${d} rounded-full flex items-center justify-center text-white font-extrabold text-sm shadow-md`,children:a.waitTimeMinutes}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:[s.canton," â€” ",s.province," Â· ",s.type]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:`text-sm font-bold ${R}`,children:[t(C[a.status])," â€” ",a.waitTimeMinutes," min"]}),e.jsx("span",{className:"text-xs text-slate-500",children:a.direction})]}),l&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-100 dark:border-slate-700 space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:t("traffic.hours")}),e.jsx("span",{className:"font-bold",children:s.open24h?"24/7":t("traffic.limited")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:t("traffic.customs")}),e.jsx("span",{className:"font-bold",children:s.customsPresent?t("traffic.yes"):t("traffic.no")})]}),a.source&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:t("traffic.source")}),e.jsx("span",{className:"font-bold",children:a.source==="google-maps"?"ðŸ“ Google Maps":`ðŸŽ² ${t("traffic.simulated")}`})]}),e.jsxs("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${s.coordinates[0]},${s.coordinates[1]}&travelmode=driving`,target:"_blank",rel:"noopener noreferrer",className:"mt-2 flex items-center justify-center gap-1.5 w-full py-2 bg-indigo-600 text-white rounded-lg text-xs font-bold hover:bg-indigo-700 transition-colors no-underline",onClick:m=>m.stopPropagation(),children:[e.jsx(k,{size:12}),t("traffic.openGoogleMaps")]})]})]},s.name)})}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30 rounded-2xl border border-blue-200 dark:border-blue-800 p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-2",children:[e.jsx(k,{size:24,className:"text-blue-600"}),t("traffic.tipsTitle")]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white/50 dark:bg-slate-900/50 rounded-xl",children:[e.jsx("p",{className:"font-bold text-blue-600 mb-2",children:t("traffic.tipsBestTimesTitle")}),e.jsxs("ul",{className:"space-y-1 text-sm text-slate-700 dark:text-slate-300 list-disc ml-4",children:[e.jsx("li",{children:t("traffic.tipsMorning")}),e.jsx("li",{children:t("traffic.tipsEvening")}),e.jsx("li",{children:t("traffic.tipsAvoidWeekend")})]})]}),e.jsxs("div",{className:"p-4 bg-white/50 dark:bg-slate-900/50 rounded-xl",children:[e.jsx("p",{className:"font-bold text-blue-600 mb-2",children:t("traffic.tipsAltRoutesTitle")}),e.jsxs("ul",{className:"space-y-1 text-sm text-slate-700 dark:text-slate-300 list-disc ml-4",children:[e.jsx("li",{children:t("traffic.tipsAvoidChiasso")}),e.jsx("li",{children:t("traffic.tipsTryAlternatives")}),e.jsx("li",{children:t("traffic.tipsLocalCrossings")})]})]})]})]})]})};export{ne as default};
//# sourceMappingURL=TrafficAlerts-B0DwFMQo.js.map
