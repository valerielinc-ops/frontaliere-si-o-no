import{_ as M}from"./vendor-pdf-og5EeDf1.js";import{c as N,u as Q,$ as W,a2 as X,w,j as e,L as ee,ac as te,i as se,a1 as ae,ad as le,b as re,a as z,e as de,p as ne}from"./index-CU426Fnh.js";import{r as m}from"./vendor-charts-aQyCzDkf.js";import{u as oe,s as ie,g as R,a as ce,l as xe,d as he}from"./firestoreService-DQJswoe8.js";import{T as E}from"./trending-down-BiBg1f3B.js";import{T as me}from"./trash-2-GyAgZBTW.js";import{C as ue}from"./chevron-up-BQo-vmDq.js";import"./vendor-firebase-BEgIyS5z.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],S=N("cloud",be);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],ge=N("hard-drive",pe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],$=N("history",fe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ne=N("log-out",je),U="frontaliere_saved_simulations";function P(){try{const u=localStorage.getItem(U);return u?JSON.parse(u):[]}catch{return[]}}function ke(u){localStorage.setItem(U,JSON.stringify(u))}const Le=({currentInputs:u,currentResult:C})=>{const{t:s}=Q(),{user:h,loading:O,signIn:B,logout:G}=oe(),[d,k]=m.useState(P),[V,q]=m.useState(null),[y,T]=m.useState(""),[I,D]=m.useState(!1),[n,v]=m.useState(null),[J,L]=m.useState(!1),[A,H]=m.useState(null);m.useEffect(()=>{ke(d)},[d]),m.useEffect(()=>{if(!h)return;let t=!0;return(async()=>{L(!0),H(null);try{const a=await xe(h.uid);if(!t)return;const o=P(),i=new Set(a.map(r=>r.id)),x=[...a.map(r=>({id:r.id,date:r.date,label:r.label,inputs:r.inputs,result:r.result,cloudId:r.id})),...o.filter(r=>!r.cloudId||!i.has(r.cloudId))];k(x)}catch(a){console.warn("Cloud sync failed:",a),t&&H("Sincronizzazione cloud fallita")}finally{t&&L(!1)}})(),()=>{t=!1}},[h]);const Y=m.useCallback(async()=>{const t=u||X,l=C||W(t),a={id:Date.now().toString(36)+Math.random().toString(36).slice(2,6),date:new Date().toISOString(),label:y||`${s("dashboard.simulation")} ${d.length+1}`,inputs:t,result:l};if(h)try{const o=await ie(h.uid,a);a.cloudId=o,a.id=o}catch(o){console.warn("Cloud save failed, keeping locally:",o)}k(o=>[a,...o]),T(""),D(!1),w("first_simulation"),d.length>=2&&w("simulation_pro")},[u,C,y,d.length,s,h]),K=async t=>{const l=d.find(a=>a.id===t);if(l!=null&&l.cloudId&&h)try{await he(l.cloudId)}catch{}k(a=>a.filter(o=>o.id!==t)),n&&(n[0]===t||n[1]===t)&&v(null)},Z=m.useCallback(async()=>{try{const{default:t}=await M(async()=>{const{default:i}=await import("./vendor-pdf-og5EeDf1.js").then(x=>x.j);return{default:i}},[]),{default:l}=await M(async()=>{const{default:i}=await import("./vendor-pdf-og5EeDf1.js").then(x=>x.c);return{default:i}},[]),a=new t;a.setFontSize(18),a.text(s("dashboard.title"),14,22),a.setFontSize(10),a.text(`${s("dashboard.exported")}: ${new Date().toLocaleDateString("it-IT")}`,14,30);const o=d.map(i=>{var x,r,b,p,g,f,j;return[new Date(i.date).toLocaleDateString("it-IT"),i.label,`CHF ${(((x=i.inputs)==null?void 0:x.grossSalary)??0).toLocaleString("it-IT")}`,`CHF ${Math.round(((b=(r=i.result)==null?void 0:r.chResident)==null?void 0:b.netAnnual)??0).toLocaleString("it-IT")}`,`â‚¬ ${Math.round(((g=(p=i.result)==null?void 0:p.itResident)==null?void 0:g.netAnnual)??0).toLocaleString("it-IT")}`,`CHF ${Math.round(((j=(f=i.result)==null?void 0:f.savings)==null?void 0:j.annual)??0).toLocaleString("it-IT")}`]});l(a,{head:[[s("dashboard.date"),s("dashboard.label"),s("dashboard.gross"),s("dashboard.netCH"),s("dashboard.netIT"),s("dashboard.savings")]],body:o,startY:36,styles:{fontSize:8}}),a.save("frontaliere-storico-simulazioni.pdf"),w("pdf_downloaded")}catch(t){console.warn("PDF export failed",t)}},[d,s]),c=m.useMemo(()=>{if(!n)return null;const t=d.find(r=>r.id===n[0]),l=d.find(r=>r.id===n[1]);if(!t||!l)return null;const a=l.result.chResident.netAnnual-t.result.chResident.netAnnual,o=l.result.itResident.netAnnual-t.result.itResident.netAnnual,i=t.result.chResident.netAnnual>0?a/t.result.chResident.netAnnual*100:0,x=t.result.itResident.netAnnual>0?o/t.result.itResident.netAnnual*100:0;return{a:t,b:l,netDiffCH:a,netDiffIT:o,pctCH:i,pctIT:x}},[n,d]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-sky-50 to-blue-50 dark:from-sky-950/30 dark:to-blue-950/30 rounded-2xl p-6 border border-sky-200 dark:border-sky-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-sky-100 dark:bg-sky-900/50 rounded-xl",children:e.jsx($,{className:"w-6 h-6 text-sky-600 dark:text-sky-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-sky-900 dark:text-sky-100",children:s("dashboard.title")})]}),e.jsx("p",{className:"text-sky-700 dark:text-sky-300 text-sm",children:s("dashboard.subtitle")})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:[O?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[e.jsx(ee,{className:"w-4 h-4 animate-spin"}),s("dashboard.loadingAuth")||"Caricamento..."]}):h?e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[R(h)?e.jsx("img",{src:R(h),alt:"",className:"w-9 h-9 rounded-full border-2 border-sky-200",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"w-9 h-9 rounded-full bg-sky-100 dark:bg-sky-900/50 flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-slate-200",children:ce(h)}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-emerald-600",children:[e.jsx(S,{className:"w-3 h-3"}),J?s("dashboard.syncing")||"Sincronizzazione...":s("dashboard.cloudSync")||"Sincronizzato con il cloud"]})]})]}),e.jsxs("button",{onClick:G,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"})," Logout"]})]}):e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(ge,{className:"w-5 h-5 text-amber-500 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-slate-200",children:s("dashboard.localMode")||"ModalitÃ  locale"}),e.jsx("p",{className:"text-[10px] text-slate-400",children:s("dashboard.loginBenefits")||"Accedi con Google per salvare nel cloud e accedere da qualsiasi dispositivo"})]})]}),e.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-xl text-sm font-bold text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors shadow-sm",children:[e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),s("dashboard.loginGoogle")||"Accedi con Google"]})]}),A&&e.jsxs("p",{className:"mt-2 text-xs text-amber-600 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," ",A]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>D(!I),className:"flex items-center gap-2 px-4 py-2.5 bg-sky-600 text-white rounded-xl text-sm font-bold hover:bg-sky-700 transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"}),s("dashboard.saveNew")]}),d.length>0&&e.jsxs("button",{onClick:Z,className:"flex items-center gap-2 px-4 py-2.5 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-xl text-sm font-bold hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(le,{className:"w-4 h-4"}),s("dashboard.exportPdf")]})]}),I&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-sky-200 dark:border-sky-800 flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{type:"text",value:y,onChange:t=>T(t.target.value),placeholder:s("dashboard.labelPlaceholder"),className:"flex-1 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-sm"}),e.jsxs("button",{onClick:Y,className:"px-4 py-2 bg-sky-600 text-white rounded-lg text-sm font-bold hover:bg-sky-700 transition-colors flex items-center gap-1.5",children:[h&&e.jsx(S,{className:"w-3.5 h-3.5"}),s("dashboard.save")]})]}),d.length>=2&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h3",{className:"font-bold text-sm text-slate-600 dark:text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),s("dashboard.compare")]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{value:(n==null?void 0:n[0])||"",onChange:t=>{var l;return v([t.target.value,(n==null?void 0:n[1])||((l=d[1])==null?void 0:l.id)||""])},className:"flex-1 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-sm",children:[e.jsx("option",{value:"",children:s("dashboard.selectA")}),d.map(t=>e.jsxs("option",{value:t.id,children:[t.label," (",new Date(t.date).toLocaleDateString("it-IT"),")"]},t.id))]}),e.jsx("span",{className:"text-slate-400 self-center",children:"vs"}),e.jsxs("select",{value:(n==null?void 0:n[1])||"",onChange:t=>{var l;return v([(n==null?void 0:n[0])||((l=d[0])==null?void 0:l.id)||"",t.target.value])},className:"flex-1 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-sm",children:[e.jsx("option",{value:"",children:s("dashboard.selectB")}),d.map(t=>e.jsxs("option",{value:t.id,children:[t.label," (",new Date(t.date).toLocaleDateString("it-IT"),")"]},t.id))]})]}),c&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${c.netDiffCH>=0?"bg-emerald-50 dark:bg-emerald-950/20":"bg-red-50 dark:bg-red-950/20"}`,children:[e.jsxs("p",{className:"text-xs text-slate-500 mb-1",children:["ðŸ‡¨ðŸ‡­ ",s("dashboard.netCH")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c.netDiffCH>=0?e.jsx(z,{className:"w-5 h-5 text-emerald-500"}):e.jsx(E,{className:"w-5 h-5 text-red-500"}),e.jsxs("span",{className:`text-xl font-black ${c.netDiffCH>=0?"text-emerald-600":"text-red-600"}`,children:[c.netDiffCH>=0?"+":"","CHF ",Math.round(c.netDiffCH).toLocaleString("it-IT")]})]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[c.pctCH>=0?"+":"",c.pctCH.toFixed(1),"%"]})]}),e.jsxs("div",{className:`p-4 rounded-lg ${c.netDiffIT>=0?"bg-emerald-50 dark:bg-emerald-950/20":"bg-red-50 dark:bg-red-950/20"}`,children:[e.jsxs("p",{className:"text-xs text-slate-500 mb-1",children:["ðŸ‡®ðŸ‡¹ ",s("dashboard.netIT")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c.netDiffIT>=0?e.jsx(z,{className:"w-5 h-5 text-emerald-500"}):e.jsx(E,{className:"w-5 h-5 text-red-500"}),e.jsxs("span",{className:`text-xl font-black ${c.netDiffIT>=0?"text-emerald-600":"text-red-600"}`,children:[c.netDiffIT>=0?"+":"","â‚¬ ",Math.round(c.netDiffIT).toLocaleString("it-IT")]})]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[c.pctIT>=0?"+":"",c.pctIT.toFixed(1),"%"]})]})]})]}),d.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-bold",children:s("dashboard.empty")}),e.jsx("p",{className:"text-sm mt-1",children:s("dashboard.emptyDesc")})]}):e.jsx("div",{className:"space-y-3",children:d.map(t=>{var a,o,i,x,r,b,p,g,f,j,_,F;const l=V===t.id;return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(de,{className:"w-3.5 h-3.5 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:new Date(t.date).toLocaleDateString("it-IT",{day:"numeric",month:"long",year:"numeric"})}),t.cloudId&&e.jsx(S,{className:"w-3 h-3 text-sky-400",title:"Cloud"})]}),e.jsx("p",{className:"font-bold text-sm text-slate-800 dark:text-slate-200",children:t.label}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1 text-xs text-slate-500",children:[e.jsxs("span",{children:["ðŸ’° CHF ",(((a=t.inputs)==null?void 0:a.grossSalary)??0).toLocaleString("it-IT")]}),e.jsxs("span",{children:["ðŸ‡¨ðŸ‡­ CHF ",Math.round(((i=(o=t.result)==null?void 0:o.chResident)==null?void 0:i.netAnnual)??0).toLocaleString("it-IT"),"/a"]}),e.jsxs("span",{children:["ðŸ‡®ðŸ‡¹ â‚¬ ",Math.round(((r=(x=t.result)==null?void 0:x.itResident)==null?void 0:r.netAnnual)??0).toLocaleString("it-IT"),"/a"]})]})]}),e.jsx("button",{onClick:()=>K(t.id),className:"p-2 text-slate-300 hover:text-red-500 transition-colors",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(l?null:t.id),className:"p-2 text-slate-400",children:l?e.jsx(ue,{size:16}):e.jsx(ne,{size:16})})]}),l&&e.jsx("div",{className:"px-4 pb-4 border-t border-slate-100 dark:border-slate-700 pt-3",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 text-center",children:[e.jsxs("div",{className:"p-2 bg-slate-50 dark:bg-slate-900 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-slate-400",children:s("dashboard.gross")}),e.jsxs("p",{className:"font-black text-sm",children:["CHF ",(((b=t.inputs)==null?void 0:b.grossSalary)??0).toLocaleString("it-IT")]})]}),e.jsxs("div",{className:"p-2 bg-slate-50 dark:bg-slate-900 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-slate-400",children:s("dashboard.family")}),e.jsxs("p",{className:"font-black text-sm",children:[((p=t.inputs)==null?void 0:p.familyMembers)??0,"p, ",((g=t.inputs)==null?void 0:g.children)??0,"b"]})]}),e.jsxs("div",{className:"p-2 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[e.jsxs("p",{className:"text-[10px] text-slate-400",children:["ðŸ‡¨ðŸ‡­ ",s("dashboard.netCH")]}),e.jsxs("p",{className:"font-black text-sm text-red-600",children:["CHF ",Math.round(((j=(f=t.result)==null?void 0:f.chResident)==null?void 0:j.netAnnual)??0).toLocaleString("it-IT")]})]}),e.jsxs("div",{className:"p-2 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsxs("p",{className:"text-[10px] text-slate-400",children:["ðŸ‡®ðŸ‡¹ ",s("dashboard.netIT")]}),e.jsxs("p",{className:"font-black text-sm text-green-600",children:["â‚¬ ",Math.round(((F=(_=t.result)==null?void 0:_.itResident)==null?void 0:F.netAnnual)??0).toLocaleString("it-IT")]})]})]})})]},t.id)})})]})};export{Le as default};
//# sourceMappingURL=PersonalDashboard-X-2tpnNK.js.map
