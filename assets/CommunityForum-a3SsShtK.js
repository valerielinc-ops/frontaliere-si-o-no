import{c as v,u as ue,A as C,w as J,j as e,ad as K,L as b,f as pe,af as V,M as W,a as he,a2 as be,i as ge}from"./index-BZ7LQtDa.js";import{r as l}from"./vendor-charts-aQyCzDkf.js";import{u as fe,b as ve,c as X,e as Ne,g as q,a as ee,f as ke,h as je,i as ye,F as te}from"./firestoreService-CpqEUYhd.js";import{A as we}from"./arrow-left-BeHIBWFg.js";import{C as A}from"./clock-mur3dLIV.js";import{F as Ce}from"./funnel-D_H8tjrt.js";import"./vendor-pdf-og5EeDf1.js";import"./vendor-firebase-BEgIyS5z.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],se=v("log-in",Ae);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],ae=v("message-circle",Se);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],$e=v("tag",Te);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],S=v("thumbs-up",Be),g={fiscalita:"ğŸ’°",permessi:"ğŸ“‹",assicurazioni:"ğŸ¥",pensione:"ğŸ¦",trasporti:"ğŸš—",residenza:"ğŸ ",lavoro:"ğŸ’¼",famiglia:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",generale:"ğŸ’¬"},f={fiscalita:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400",permessi:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",assicurazioni:"bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-400",pensione:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",trasporti:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",residenza:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400",lavoro:"bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400",famiglia:"bg-pink-100 text-pink-700 dark:bg-pink-900/30 dark:text-pink-400",generale:"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300"};function T(a){if(!a)return"";const s=Math.floor((Date.now()-a.getTime())/1e3);return s<60?"adesso":s<3600?`${Math.floor(s/60)} min fa`:s<86400?`${Math.floor(s/3600)}h fa`:s<2592e3?`${Math.floor(s/86400)}g fa`:a.toLocaleDateString("it-IT",{day:"numeric",month:"short"})}const Re=()=>{var Z;const{t:a}=ue(),{user:s,signIn:$}=fe(),[B,P]=l.useState([]),[le,_]=l.useState(!0),[M,U]=l.useState(null),[N,re]=l.useState(""),[u,I]=l.useState("recent"),[o,k]=l.useState(null),[L,p]=l.useState([]),[oe,F]=l.useState(!1),[Q,j]=l.useState(!1),[i,R]=l.useState(""),[d,E]=l.useState(""),[h,ne]=l.useState("generale"),[y,D]=l.useState(""),[z,O]=l.useState(!1),[c,G]=l.useState(""),[H,Y]=l.useState(!1),x=l.useCallback(async()=>{_(!0),U(null);try{const t=await ve({category:N||void 0,sortBy:u});P(t)}catch(t){console.warn("Failed to load questions:",t),U(a("forum.loadError")||"Errore nel caricamento delle domande")}finally{_(!1)}},[N,u,a]);l.useEffect(()=>{x()},[x]);const ie=l.useCallback(async t=>{k(t),F(!0);try{const r=await X(t.id);p(r)}catch(r){console.warn("Failed to load answers:",r)}finally{F(!1)}C.trackUIInteraction("forum","question","view",t.id)},[]),de=l.useCallback(async()=>{if(!(!s||!i.trim()||!d.trim())){O(!0);try{await Ne({title:i.trim(),body:d.trim(),authorId:s.uid,authorName:ee(s),authorPhoto:q(s),category:h,tags:y.split(",").map(t=>t.trim()).filter(Boolean)}),R(""),E(""),D(""),j(!1),J("forum_first_question"),await x(),C.trackUIInteraction("forum","question","create",h)}catch(t){console.warn("Failed to create question:",t)}finally{O(!1)}}},[s,i,d,h,y,x]),ce=l.useCallback(async()=>{if(!(!s||!o||!c.trim())){Y(!0);try{await ke({questionId:o.id,body:c.trim(),authorId:s.uid,authorName:ee(s),authorPhoto:q(s)}),G("");const t=await X(o.id);p(t),k(r=>r?{...r,answerCount:r.answerCount+1}:null),J("forum_first_answer"),C.trackUIInteraction("forum","answer","create",o.id)}catch(t){console.warn("Failed to create answer:",t)}finally{Y(!1)}}},[s,o,c]),xe=l.useCallback(async t=>{if(s)try{await je(t,s.uid),P(r=>r.map(n=>{if(n.id!==t)return n;const m=n.upvotedBy.includes(s.uid);return{...n,upvotes:m?n.upvotes-1:n.upvotes+1,upvotedBy:m?n.upvotedBy.filter(w=>w!==s.uid):[...n.upvotedBy,s.uid]}}))}catch(r){console.warn("Upvote failed:",r)}},[s]),me=l.useCallback(async t=>{if(s)try{await ye(t,s.uid),p(r=>r.map(n=>{if(n.id!==t)return n;const m=n.upvotedBy.includes(s.uid);return{...n,upvotes:m?n.upvotes-1:n.upvotes+1,upvotedBy:m?n.upvotedBy.filter(w=>w!==s.uid):[...n.upvotedBy,s.uid]}}))}catch(r){console.warn("Upvote answer failed:",r)}},[s]);return o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:()=>{k(null),p([])},className:"flex items-center gap-2 text-sm font-bold text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 transition-colors",children:[e.jsx(we,{className:"w-4 h-4"}),a("forum.backToList")||"Torna alle domande"]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("button",{onClick:()=>xe(o.id),disabled:!s,className:`p-1.5 rounded-lg transition-colors ${s&&o.upvotedBy.includes(s.uid)?"bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400":"text-slate-300 hover:text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-900/20"} ${s?"":"opacity-50 cursor-not-allowed"}`,children:e.jsx(S,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-sm font-black text-slate-600 dark:text-slate-300",children:o.upvotes})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 dark:text-slate-100 mb-2",children:o.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-500 whitespace-pre-wrap leading-relaxed",children:o.body}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-4",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-bold ${f[o.category]||f.generale}`,children:[g[o.category]," ",a(`forum.cat.${o.category}`)]}),o.tags.map(t=>e.jsxs("span",{className:"inline-flex items-center gap-0.5 px-1.5 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-500 rounded text-[10px]",children:[e.jsx($e,{className:"w-2.5 h-2.5"}),t]},t))]}),e.jsxs("div",{className:"flex items-center gap-3 mt-3 text-xs text-slate-500",children:[o.authorPhoto?e.jsx("img",{src:o.authorPhoto,alt:"",className:"w-5 h-5 rounded-full",referrerPolicy:"no-referrer"}):e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"font-bold",children:o.authorName}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"}),T(((Z=o.createdAt)==null?void 0:Z.toDate())||null)]})]})]})]})})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-sm text-slate-600 dark:text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),o.answerCount," ",a("forum.answers")||"Risposte"]}),oe?e.jsx("div",{className:"text-center py-8 text-slate-500",children:e.jsx(b,{className:"w-6 h-6 animate-spin mx-auto mb-2"})}):L.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500 text-sm",children:a("forum.noAnswers")||"Nessuna risposta ancora. Sii il primo!"}):e.jsx("div",{className:"space-y-3",children:L.map(t=>{var r;return e.jsx("div",{className:`bg-white dark:bg-slate-800 rounded-xl border p-4 ${t.accepted?"border-emerald-300 dark:border-emerald-700 bg-emerald-50/50 dark:bg-emerald-950/10":"border-slate-200 dark:border-slate-700"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("button",{onClick:()=>me(t.id),disabled:!s,className:`p-1 rounded-lg transition-colors ${s&&t.upvotedBy.includes(s.uid)?"bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400":"text-slate-300 hover:text-emerald-500"} ${s?"":"opacity-50 cursor-not-allowed"}`,children:e.jsx(S,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-xs font-bold text-slate-500",children:t.upvotes}),t.accepted&&e.jsx(pe,{className:"w-4 h-4 text-emerald-500"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 whitespace-pre-wrap leading-relaxed",children:t.body}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-[11px] text-slate-500",children:[t.authorPhoto?e.jsx("img",{src:t.authorPhoto,alt:"",className:"w-4 h-4 rounded-full",referrerPolicy:"no-referrer"}):e.jsx(K,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"font-bold",children:t.authorName}),e.jsx("span",{children:T(((r=t.createdAt)==null?void 0:r.toDate())||null)})]})]})]})},t.id)})})]}),s?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:[e.jsx("textarea",{value:c,onChange:t=>G(t.target.value),placeholder:a("forum.answerPlaceholder")||"Scrivi la tua risposta...",className:"w-full px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-sm min-h-[80px] resize-y"}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsxs("button",{onClick:ce,disabled:H||!c.trim(),className:"flex items-center gap-1.5 px-4 py-2 bg-sky-600 text-white rounded-lg text-sm font-bold hover:bg-sky-700 disabled:opacity-50 transition-colors",children:[H?e.jsx(b,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(V,{className:"w-3.5 h-3.5"}),a("forum.submitAnswer")||"Rispondi"]})})]}):e.jsx("div",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-xl p-4 text-center",children:e.jsxs("button",{onClick:$,className:"flex items-center gap-2 mx-auto px-4 py-2 bg-sky-600 text-white rounded-lg text-sm font-bold hover:bg-sky-700 transition-colors",children:[e.jsx(se,{className:"w-4 h-4"}),a("forum.loginToAnswer")||"Accedi per rispondere"]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-purple-50 dark:from-violet-950/30 dark:to-purple-950/30 rounded-2xl p-6 border border-violet-200 dark:border-violet-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-violet-100 dark:bg-violet-900/50 rounded-xl",children:e.jsx(W,{className:"w-6 h-6 text-violet-600 dark:text-violet-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-violet-900 dark:text-violet-100",children:a("forum.title")})]}),e.jsx("p",{className:"text-violet-700 dark:text-violet-300 text-sm",children:a("forum.subtitle")})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-slate-500 shrink-0"}),e.jsxs("select",{value:N,onChange:t=>re(t.target.value),className:"flex-1 px-3 py-2 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-sm font-bold",children:[e.jsx("option",{value:"",children:a("forum.allCategories")||"Tutte le categorie"}),te.map(t=>e.jsxs("option",{value:t,children:[g[t]," ",a(`forum.cat.${t}`)]},t))]})]}),e.jsxs("div",{className:"flex gap-1 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-0.5",children:[e.jsxs("button",{onClick:()=>I("recent"),className:`flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-bold transition-colors ${u==="recent"?"bg-violet-100 text-violet-700 dark:bg-violet-900/30 dark:text-violet-400":"text-slate-500"}`,children:[e.jsx(A,{className:"w-3 h-3"})," ",a("forum.recent")||"Recenti"]}),e.jsxs("button",{onClick:()=>I("popular"),className:`flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-bold transition-colors ${u==="popular"?"bg-violet-100 text-violet-700 dark:bg-violet-900/30 dark:text-violet-400":"text-slate-500"}`,children:[e.jsx(he,{className:"w-3 h-3"})," ",a("forum.popular")||"Popolari"]})]}),s?e.jsxs("button",{onClick:()=>j(!Q),className:"flex items-center gap-2 px-4 py-2.5 bg-violet-600 text-white rounded-xl text-sm font-bold hover:bg-violet-700 transition-colors",children:[e.jsx(be,{className:"w-4 h-4"}),a("forum.askQuestion")||"Fai una domanda"]}):e.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-4 py-2.5 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-xl text-sm font-bold hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(se,{className:"w-4 h-4"}),a("forum.loginToAsk")||"Accedi per chiedere"]})]}),Q&&s&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-violet-200 dark:border-violet-800 p-5 space-y-3",children:[e.jsx("input",{type:"text",value:i,onChange:t=>R(t.target.value),placeholder:a("forum.titlePlaceholder")||"Titolo della domanda...",className:"w-full px-4 py-2.5 rounded-lg bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-sm font-bold",maxLength:200}),e.jsx("textarea",{value:d,onChange:t=>E(t.target.value),placeholder:a("forum.bodyPlaceholder")||"Descrivi la tua domanda in dettaglio...",className:"w-full px-4 py-2.5 rounded-lg bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-sm min-h-[120px] resize-y"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:a("forum.category")||"Categoria"}),e.jsx("select",{value:h,onChange:t=>ne(t.target.value),className:"w-full px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-sm",children:te.map(t=>e.jsxs("option",{value:t,children:[g[t]," ",a(`forum.cat.${t}`)]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:a("forum.tags")||"Tag (separati da virgola)"}),e.jsx("input",{type:"text",value:y,onChange:t=>D(t.target.value),placeholder:"es: tasse, permesso G, ticino",className:"w-full px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-sm"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 text-sm font-bold text-slate-500 hover:text-slate-700 transition-colors",children:a("forum.cancel")||"Annulla"}),e.jsxs("button",{onClick:de,disabled:z||!i.trim()||!d.trim(),className:"flex items-center gap-1.5 px-4 py-2 bg-violet-600 text-white rounded-lg text-sm font-bold hover:bg-violet-700 disabled:opacity-50 transition-colors",children:[z?e.jsx(b,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(V,{className:"w-3.5 h-3.5"}),a("forum.submit")||"Pubblica"]})]})]}),le?e.jsxs("div",{className:"text-center py-12 text-slate-500",children:[e.jsx(b,{className:"w-8 h-8 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:a("forum.loading")||"Caricamento domande..."})]}):M?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"w-8 h-8 text-amber-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-amber-600",children:M}),e.jsx("button",{onClick:x,className:"mt-3 text-sm font-bold text-violet-600 hover:text-violet-700",children:a("forum.retry")||"Riprova"})]}):B.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-500",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-bold",children:a("forum.empty")||"Nessuna domanda ancora"}),e.jsx("p",{className:"text-sm mt-1",children:a("forum.emptyDesc")||"Sii il primo a fare una domanda alla community!"})]}):e.jsx("div",{className:"space-y-3",children:B.map(t=>{var r;return e.jsx("button",{onClick:()=>ie(t),className:"w-full text-left bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4 hover:border-violet-300 dark:hover:border-violet-700 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-0.5 pt-0.5",children:[e.jsx(S,{className:`w-4 h-4 ${s&&t.upvotedBy.includes(s.uid)?"text-emerald-500":"text-slate-300"}`}),e.jsx("span",{className:"text-xs font-black text-slate-500",children:t.upvotes})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-800 dark:text-slate-200 line-clamp-2",children:t.title}),e.jsx("p",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:t.body}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-[9px] font-bold ${f[t.category]||f.generale}`,children:[g[t.category]," ",a(`forum.cat.${t.category}`)]}),t.tags.slice(0,3).map(n=>e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-500 rounded text-[9px]",children:n},n)),e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-500 ml-auto",children:[e.jsx(ae,{className:"w-3 h-3"})," ",t.answerCount,e.jsx("span",{className:"mx-1",children:"Â·"}),e.jsx(A,{className:"w-3 h-3"})," ",T(((r=t.createdAt)==null?void 0:r.toDate())||null)]})]})]})]})},t.id)})})]})};export{Re as default};
//# sourceMappingURL=CommunityForum-a3SsShtK.js.map
